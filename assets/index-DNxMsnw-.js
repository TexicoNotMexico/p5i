var bo=Object.defineProperty;var To=(y,T,h)=>T in y?bo(y,T,{enumerable:!0,configurable:!0,writable:!0,value:h}):y[T]=h;var z=(y,T,h)=>To(y,typeof T!="symbol"?T+"":T,h);(function(){const T=document.createElement("link").relList;if(T&&T.supports&&T.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))g(f);new MutationObserver(f=>{for(const o of f)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&g(r)}).observe(document,{childList:!0,subtree:!0});function h(f){const o={};return f.integrity&&(o.integrity=f.integrity),f.referrerPolicy&&(o.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?o.credentials="include":f.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function g(f){if(f.ep)return;f.ep=!0;const o=h(f);fetch(f.href,o)}})();const F=1920,le=1080,wo=60,qt=210,Fe=["#D66873","#000000","#4E9F36","#B4A537","#00339D","#C4C3C6","#C4C3C6"];let Vt,Me,Ie;const So=()=>{Me=p.loadFont("NotoSansJP-Bold.otf"),Ie=p.loadFont("NotoSansJP-Medium.otf")},qe=()=>{Vt=Me,p.textFont(Vt)},Ao=()=>{Vt=Ie,p.textFont(Vt)};(function(){(function(y){var T={};function h(g){if(T[g])return T[g].exports;var f=T[g]={i:g,l:!1,exports:{}};return y[g].call(f.exports,f,f.exports,h),f.l=!0,f.exports}return h.m=y,h.c=T,h.d=function(g,f,o){h.o(g,f)||Object.defineProperty(g,f,{enumerable:!0,get:o})},h.r=function(g){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},h.t=function(g,f){if(f&1&&(g=h(g)),f&8||f&4&&typeof g=="object"&&g&&g.__esModule)return g;var o=Object.create(null);if(h.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:g}),f&2&&typeof g!="string")for(var r in g)h.d(o,r,(function(a){return g[a]}).bind(null,r));return o},h.n=function(g){var f=g&&g.__esModule?function(){return g.default}:function(){return g};return h.d(f,"a",f),f},h.o=function(g,f){return Object.prototype.hasOwnProperty.call(g,f)},h.p="",h(h.s=40)})([function(y,T,h){var g;g=(function(){function f(r,a){this.isUndef(r)||r===1?this.input=this.context.createGain():1<r&&(this.input=new Array(r)),this.isUndef(a)||a===1?this.output=this.context.createGain():1<a&&(this.output=new Array(r))}var o;return f.prototype.set=function(r,a,c){if(this.isObject(r))c=a;else if(this.isString(r)){var l={};l[r]=a,r=l}t:for(var d in r){a=r[d];var _=this;if(d.indexOf(".")!==-1){for(var w=d.split("."),S=0;S<w.length-1;S++)if((_=_[w[S]])instanceof f){w.splice(0,S+1);var k=w.join(".");_.set(k,a);continue t}d=w[w.length-1]}var A=_[d];this.isUndef(A)||(f.Signal&&A instanceof f.Signal||f.Param&&A instanceof f.Param?A.value!==a&&(this.isUndef(c)?A.value=a:A.rampTo(a,c)):A instanceof AudioParam?A.value!==a&&(A.value=a):A instanceof f?A.set(a):A!==a&&(_[d]=a))}return this},f.prototype.get=function(r){this.isUndef(r)?r=this._collectDefaults(this.constructor):this.isString(r)&&(r=[r]);for(var a={},c=0;c<r.length;c++){var l=r[c],d=this,_=a;if(l.indexOf(".")!==-1){for(var w=l.split("."),S=0;S<w.length-1;S++){var k=w[S];_[k]=_[k]||{},_=_[k],d=d[k]}l=w[w.length-1]}var A=d[l];this.isObject(r[l])?_[l]=A.get():f.Signal&&A instanceof f.Signal||f.Param&&A instanceof f.Param||A instanceof AudioParam?_[l]=A.value:A instanceof f?_[l]=A.get():this.isFunction(A)||this.isUndef(A)||(_[l]=A)}return a},f.prototype._collectDefaults=function(r){var a=[];if(this.isUndef(r.defaults)||(a=Object.keys(r.defaults)),!this.isUndef(r._super))for(var c=this._collectDefaults(r._super),l=0;l<c.length;l++)a.indexOf(c[l])===-1&&a.push(c[l]);return a},f.prototype.toString=function(){for(var r in f){var a=r[0].match(/^[A-Z]$/),c=f[r]===this.constructor;if(this.isFunction(f[r])&&a&&c)return r}return"Tone"},Object.defineProperty(f.prototype,"numberOfInputs",{get:function(){return this.input?this.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(f.prototype,"numberOfOutputs",{get:function(){return this.output?this.isArray(this.output)?this.output.length:1:0}}),f.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this},f.prototype.connect=function(r,a,c){return Array.isArray(this.output)?(a=this.defaultArg(a,0),this.output[a].connect(r,0,c)):this.output.connect(r,a,c),this},f.prototype.disconnect=function(r,a,c){this.isArray(this.output)?this.isNumber(r)?this.output[r].disconnect():(a=this.defaultArg(a,0),this.output[a].disconnect(r,0,c)):this.output.disconnect.apply(this.output,arguments)},f.prototype.connectSeries=function(){if(1<arguments.length)for(var r=arguments[0],a=1;a<arguments.length;a++){var c=arguments[a];r.connect(c),r=c}return this},f.prototype.chain=function(){if(0<arguments.length)for(var r=this,a=0;a<arguments.length;a++){var c=arguments[a];r.connect(c),r=c}return this},f.prototype.fan=function(){if(0<arguments.length)for(var r=0;r<arguments.length;r++)this.connect(arguments[r]);return this},AudioNode.prototype.chain=f.prototype.chain,AudioNode.prototype.fan=f.prototype.fan,f.prototype.defaultArg=function(r,a){if(this.isObject(r)&&this.isObject(a)){var c={};for(var l in r)c[l]=this.defaultArg(a[l],r[l]);for(var d in a)c[d]=this.defaultArg(r[d],a[d]);return c}return this.isUndef(r)?a:r},f.prototype.optionsObject=function(r,a,c){var l={};if(r.length===1&&this.isObject(r[0]))l=r[0];else for(var d=0;d<a.length;d++)l[a[d]]=r[d];return this.isUndef(c)?l:this.defaultArg(l,c)},f.prototype.isUndef=function(r){return r===void 0},f.prototype.isFunction=function(r){return typeof r=="function"},f.prototype.isNumber=function(r){return typeof r=="number"},f.prototype.isObject=function(r){return Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object},f.prototype.isBoolean=function(r){return typeof r=="boolean"},f.prototype.isArray=function(r){return Array.isArray(r)},f.prototype.isString=function(r){return typeof r=="string"},f.noOp=function(){},f.prototype._readOnly=function(r){if(Array.isArray(r))for(var a=0;a<r.length;a++)this._readOnly(r[a]);else Object.defineProperty(this,r,{writable:!1,enumerable:!0})},f.prototype._writable=function(r){if(Array.isArray(r))for(var a=0;a<r.length;a++)this._writable(r[a]);else Object.defineProperty(this,r,{writable:!0})},f.State={Started:"started",Stopped:"stopped",Paused:"paused"},f.prototype.equalPowerScale=function(r){var a=.5*Math.PI;return Math.sin(r*a)},f.prototype.dbToGain=function(r){return Math.pow(2,r/6)},f.prototype.gainToDb=function(r){return Math.log(r)/Math.LN10*20},f.prototype.intervalToFrequencyRatio=function(r){return Math.pow(2,r/12)},f.prototype.now=function(){return f.context.now()},f.now=function(){return f.context.now()},f.extend=function(r,a){function c(){}f.prototype.isUndef(a)&&(a=f),c.prototype=a.prototype,r.prototype=new c,(r.prototype.constructor=r)._super=a},Object.defineProperty(f,"context",{get:function(){return o},set:function(r){o=f.Context&&r instanceof f.Context?r:new f.Context(r),f.Context&&f.Context.emit("init",o)}}),Object.defineProperty(f.prototype,"context",{get:function(){return f.context}}),f.setContext=function(r){f.context=r},Object.defineProperty(f.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(f.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(f,"supported",{get:function(){var r=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),a=window.hasOwnProperty("Promise"),c=window.hasOwnProperty("Worker");return r&&a&&c}}),f.version="r10",window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+f.version+" * ","background: #000; color: #fff"),f}).call(T,h,T,y),g!==void 0&&(y.exports=g)},function(y,T,h){var g,f;g=[h(0),h(2),h(10)],f=(function(o){return o.Multiply=function(r){this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new o.Gain,this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(r,0)},o.extend(o.Multiply,o.Signal),o.Multiply.prototype.dispose=function(){return o.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},o.Multiply}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(6),h(9),h(18),h(10)],f=(function(o){return o.Signal=function(){var r=this.optionsObject(arguments,["value","units"],o.Signal.defaults);this.output=this._gain=this.context.createGain(),r.param=this._gain.gain,o.Param.call(this,r),this.input=this._param=this._gain.gain,this.context.getConstant(1).chain(this._gain)},o.extend(o.Signal,o.Param),o.Signal.defaults={value:0,units:o.Type.Default,convert:!0},o.Signal.prototype.connect=o.SignalBase.prototype.connect,o.Signal.prototype.dispose=function(){return o.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},o.Signal}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){(function(g){h.d(T,"b",function(){return d}),h.d(T,"c",function(){return _});var f=h(22),o=h.n(f),r=h(0),a=h.n(r),c=h(12);h.n(c),g.TONE_SILENCE_VERSION_LOGGING=!0;var l=new window.AudioContext;a.a.setContext(l);function d(){return l}function _(w,S){var k=w;return w instanceof p5.Element?k=w.elt:w instanceof Array&&w[0]instanceof p5.Element&&(k=w.map(function(A){return A.elt})),o()(l,k,S)}T.a=l}).call(this,h(26))},function(y,T,h){var g,f;g=[h(0),h(2),h(10)],f=(function(o){return o.Add=function(r){this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new o.Gain,this._param=this.input[1]=new o.Signal(r),this._param.connect(this._sum)},o.extend(o.Add,o.Signal),o.Add.prototype.dispose=function(){return o.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this._param.dispose(),this._param=null,this},o.Add}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T){y.exports={recorderProcessor:"recorder-processor",soundFileProcessor:"sound-file-processor",amplitudeProcessor:"amplitude-processor"}},function(y,T,h){var g,f;g=[h(0),h(15)],f=(function(o){return o.WaveShaper=function(r,a){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(r)?this.curve=r:isFinite(r)||this.isUndef(r)?this._curve=new Float32Array(this.defaultArg(r,1024)):this.isFunction(r)&&(this._curve=new Float32Array(this.defaultArg(a,1024)),this.setMap(r))},o.extend(o.WaveShaper,o.SignalBase),o.WaveShaper.prototype.setMap=function(r){for(var a=0,c=this._curve.length;a<c;a++){var l=a/(c-1)*2-1;this._curve[a]=r(l,a)}return this._shaper.curve=this._curve,this},Object.defineProperty(o.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(r){this._curve=new Float32Array(r),this._shaper.curve=this._curve}}),Object.defineProperty(o.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(r){if(["none","2x","4x"].indexOf(r)===-1)throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=r}}),o.WaveShaper.prototype.dispose=function(){return o.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},o.WaveShaper}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(2),h(19)],f=(function(o){return o.TimelineSignal=function(){var r=this.optionsObject(arguments,["value","units"],o.Signal.defaults);this._events=new o.Timeline(10),o.Signal.apply(this,r),r.param=this._param,o.Param.call(this,r),this._initial=this._fromUnits(this._param.value)},o.extend(o.TimelineSignal,o.Param),o.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"},Object.defineProperty(o.TimelineSignal.prototype,"value",{get:function(){var r=this.now(),a=this.getValueAtTime(r);return this._toUnits(a)},set:function(r){var a=this._fromUnits(r);this._initial=a,this.cancelScheduledValues(),this._param.value=a}}),o.TimelineSignal.prototype.setValueAtTime=function(r,a){return r=this._fromUnits(r),a=this.toSeconds(a),this._events.add({type:o.TimelineSignal.Type.Set,value:r,time:a}),this._param.setValueAtTime(r,a),this},o.TimelineSignal.prototype.linearRampToValueAtTime=function(r,a){return r=this._fromUnits(r),a=this.toSeconds(a),this._events.add({type:o.TimelineSignal.Type.Linear,value:r,time:a}),this._param.linearRampToValueAtTime(r,a),this},o.TimelineSignal.prototype.exponentialRampToValueAtTime=function(r,a){a=this.toSeconds(a);var c=this._searchBefore(a);c&&c.value===0&&this.setValueAtTime(this._minOutput,c.time),r=this._fromUnits(r);var l=Math.max(r,this._minOutput);return this._events.add({type:o.TimelineSignal.Type.Exponential,value:l,time:a}),r<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,a-this.sampleTime),this.setValueAtTime(0,a)):this._param.exponentialRampToValueAtTime(r,a),this},o.TimelineSignal.prototype.setTargetAtTime=function(r,a,c){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),c=Math.max(this._minOutput,c),a=this.toSeconds(a),this._events.add({type:o.TimelineSignal.Type.Target,value:r,time:a,constant:c}),this._param.setTargetAtTime(r,a,c),this},o.TimelineSignal.prototype.setValueCurveAtTime=function(r,a,c,l){l=this.defaultArg(l,1);for(var d=new Array(r.length),_=0;_<d.length;_++)d[_]=this._fromUnits(r[_])*l;a=this.toSeconds(a),c=this.toSeconds(c),this._events.add({type:o.TimelineSignal.Type.Curve,value:d,time:a,duration:c}),this._param.setValueAtTime(d[0],a);for(var w=1;w<d.length;w++){var S=a+w/(d.length-1)*c;this._param.linearRampToValueAtTime(d[w],S)}return this},o.TimelineSignal.prototype.cancelScheduledValues=function(r){return r=this.toSeconds(r),this._events.cancel(r),this._param.cancelScheduledValues(r),this},o.TimelineSignal.prototype.setRampPoint=function(r){r=this.toSeconds(r);var a=this._toUnits(this.getValueAtTime(r)),c=this._searchBefore(r);if(c&&c.time===r)this.cancelScheduledValues(r+this.sampleTime);else if(c&&c.type===o.TimelineSignal.Type.Curve&&c.time+c.duration>r)this.cancelScheduledValues(r),this.linearRampToValueAtTime(a,r);else{var l=this._searchAfter(r);l&&(this.cancelScheduledValues(r),l.type===o.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(a,r):l.type===o.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(a,r)),this.setValueAtTime(a,r)}return this},o.TimelineSignal.prototype.linearRampToValueBetween=function(r,a,c){return this.setRampPoint(a),this.linearRampToValueAtTime(r,c),this},o.TimelineSignal.prototype.exponentialRampToValueBetween=function(r,a,c){return this.setRampPoint(a),this.exponentialRampToValueAtTime(r,c),this},o.TimelineSignal.prototype._searchBefore=function(r){return this._events.get(r)},o.TimelineSignal.prototype._searchAfter=function(r){return this._events.getAfter(r)},o.TimelineSignal.prototype.getValueAtTime=function(r){r=this.toSeconds(r);var a=this._searchAfter(r),c=this._searchBefore(r),l=this._initial;if(c===null)l=this._initial;else if(c.type===o.TimelineSignal.Type.Target){var d,_=this._events.getBefore(c.time);d=_===null?this._initial:_.value,l=this._exponentialApproach(c.time,d,c.value,c.constant,r)}else l=c.type===o.TimelineSignal.Type.Curve?this._curveInterpolate(c.time,c.value,c.duration,r):a===null?c.value:a.type===o.TimelineSignal.Type.Linear?this._linearInterpolate(c.time,c.value,a.time,a.value,r):a.type===o.TimelineSignal.Type.Exponential?this._exponentialInterpolate(c.time,c.value,a.time,a.value,r):c.value;return l},o.TimelineSignal.prototype.connect=o.SignalBase.prototype.connect,o.TimelineSignal.prototype._exponentialApproach=function(r,a,c,l,d){return c+(a-c)*Math.exp(-(d-r)/l)},o.TimelineSignal.prototype._linearInterpolate=function(r,a,c,l,d){return a+(d-r)/(c-r)*(l-a)},o.TimelineSignal.prototype._exponentialInterpolate=function(r,a,c,l,d){return(a=Math.max(this._minOutput,a))*Math.pow(l/a,(d-r)/(c-r))},o.TimelineSignal.prototype._curveInterpolate=function(r,a,c,l){var d=a.length;if(r+c<=l)return a[d-1];if(l<=r)return a[0];var _=(l-r)/c,w=Math.floor((d-1)*_),S=Math.ceil((d-1)*_),k=a[w],A=a[S];return S===w?k:this._linearInterpolate(w,k,S,A,_*(d-1))},o.TimelineSignal.prototype.dispose=function(){o.Signal.prototype.dispose.call(this),o.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},o.TimelineSignal}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(4),h(1),h(2)],f=(function(o){return o.Scale=function(r,a){this._outputMin=this.defaultArg(r,0),this._outputMax=this.defaultArg(a,1),this._scale=this.input=new o.Multiply(1),this._add=this.output=new o.Add(0),this._scale.connect(this._add),this._setRange()},o.extend(o.Scale,o.SignalBase),Object.defineProperty(o.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(r){this._outputMin=r,this._setRange()}}),Object.defineProperty(o.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(r){this._outputMax=r,this._setRange()}}),o.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},o.Scale.prototype.dispose=function(){return o.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},o.Scale}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(16),h(30),h(31),h(12)],f=(function(o){return o.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},o.prototype.toSeconds=function(r){return this.isNumber(r)?r:this.isUndef(r)?this.now():this.isString(r)?new o.Time(r).toSeconds():r instanceof o.TimeBase?r.toSeconds():void 0},o.prototype.toFrequency=function(r){return this.isNumber(r)?r:this.isString(r)||this.isUndef(r)?new o.Frequency(r).valueOf():r instanceof o.TimeBase?r.toFrequency():void 0},o.prototype.toTicks=function(r){return this.isNumber(r)||this.isString(r)?new o.TransportTime(r).toTicks():this.isUndef(r)?o.Transport.ticks:r instanceof o.TimeBase?r.toTicks():void 0},o}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(18),h(9)],f=(function(o){return window.GainNode&&!AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),o.Gain=function(){var r=this.optionsObject(arguments,["gain","units"],o.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new o.Param({param:this._gainNode.gain,units:r.units,value:r.gain,convert:r.convert}),this._readOnly("gain")},o.extend(o.Gain),o.Gain.defaults={gain:1,convert:!0},o.Gain.prototype.dispose=function(){o.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},o.prototype.createInsOuts=function(r,a){r===1?this.input=new o.Gain:1<r&&(this.input=new Array(r)),a===1?this.output=new o.Gain:1<a&&(this.output=new Array(r))},o.Gain}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(7),h(39),h(14),h(12)],f=(function(o){return o.Clock=function(){o.Emitter.call(this);var r=this.optionsObject(arguments,["callback","frequency"],o.Clock.defaults);this.callback=r.callback,this._nextTick=0,this._lastState=o.State.Stopped,this.frequency=new o.TimelineSignal(r.frequency,o.Type.Frequency),this._readOnly("frequency"),this.ticks=0,this._state=new o.TimelineState(o.State.Stopped),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},o.extend(o.Clock,o.Emitter),o.Clock.defaults={callback:o.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(o.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),o.Clock.prototype.start=function(r,a){return r=this.toSeconds(r),this._state.getValueAtTime(r)!==o.State.Started&&this._state.add({state:o.State.Started,time:r,offset:a}),this},o.Clock.prototype.stop=function(r){return r=this.toSeconds(r),this._state.cancel(r),this._state.setStateAtTime(o.State.Stopped,r),this},o.Clock.prototype.pause=function(r){return r=this.toSeconds(r),this._state.getValueAtTime(r)===o.State.Started&&this._state.setStateAtTime(o.State.Paused,r),this},o.Clock.prototype._loop=function(){for(var r=this.now()+this.context.lookAhead+this.context.updateInterval+2*this.context.lag;r>this._nextTick&&this._state;){var a=this._state.getValueAtTime(this._nextTick);if(a!==this._lastState){this._lastState=a;var c=this._state.get(this._nextTick);a===o.State.Started?(this._nextTick=c.time,this.isUndef(c.offset)||(this.ticks=c.offset),this.emit("start",c.time,this.ticks)):a===o.State.Stopped?(this.ticks=0,this.emit("stop",c.time)):a===o.State.Paused&&this.emit("pause",c.time)}var l=this._nextTick;this.frequency&&(this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),a===o.State.Started&&(this.callback(l),this.ticks++))}},o.Clock.prototype.getStateAtTime=function(r){return r=this.toSeconds(r),this._state.getValueAtTime(r)},o.Clock.prototype.dispose=function(){o.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},o.Clock}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(14)],f=(function(o){function r(l,d,_){if(l.input)Array.isArray(l.input)?(o.prototype.isUndef(_)&&(_=0),this.connect(l.input[_])):this.connect(l.input,d,_);else try{l instanceof AudioNode?a.call(this,l,d,_):a.call(this,l,d)}catch(w){throw new Error("error connecting to node: "+l+`
`+w)}}var a,c;return!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),o.Context=function(l){for(var d in o.Emitter.call(this),l=l||new window.AudioContext,this._context=l,this._context)this._defineProperty(this._context,d);this._latencyHint="interactive",this._lookAhead=.1,this._updateInterval=this._lookAhead/3,this._computedUpdateInterval=0,this._worker=this._createWorker(),this._constants={}},o.extend(o.Context,o.Emitter),o.Emitter.mixin(o.Context),o.Context.prototype._defineProperty=function(l,d){this.isUndef(this[d])&&Object.defineProperty(this,d,{get:function(){return typeof l[d]=="function"?l[d].bind(l):l[d]},set:function(_){l[d]=_}})},o.Context.prototype.now=function(){return this._context.currentTime},o.Context.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var l=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){	timeoutTime = parseInt(msg.data);};function tick(){	setTimeout(tick, timeoutTime);	self.postMessage('tick');}tick();"]),d=URL.createObjectURL(l),_=new Worker(d);return _.addEventListener("message",(function(){this.emit("tick")}).bind(this)),_.addEventListener("message",(function(){var w=this.now();if(this.isNumber(this._lastUpdate)){var S=w-this._lastUpdate;this._computedUpdateInterval=Math.max(S,.97*this._computedUpdateInterval)}this._lastUpdate=w}).bind(this)),_},o.Context.prototype.getConstant=function(l){if(this._constants[l])return this._constants[l];for(var d=this._context.createBuffer(1,128,this._context.sampleRate),_=d.getChannelData(0),w=0;w<_.length;w++)_[w]=l;var S=this._context.createBufferSource();return S.channelCount=1,S.channelCountMode="explicit",S.buffer=d,S.loop=!0,S.start(0),this._constants[l]=S},Object.defineProperty(o.Context.prototype,"lag",{get:function(){var l=this._computedUpdateInterval-this._updateInterval;return l=Math.max(l,0)}}),Object.defineProperty(o.Context.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(l){this._lookAhead=l}}),Object.defineProperty(o.Context.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(l){this._updateInterval=Math.max(l,o.prototype.blockTime),this._worker.postMessage(Math.max(1e3*l,1))}}),Object.defineProperty(o.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(l){var d=l;if(this._latencyHint=l,this.isString(l))switch(l){case"interactive":d=.1,this._context.latencyHint=l;break;case"playback":d=.8,this._context.latencyHint=l;break;case"balanced":d=.25,this._context.latencyHint=l;break;case"fastest":d=.01}this.lookAhead=d,this.updateInterval=d/3}}),o.supported?(a=AudioNode.prototype.connect,c=AudioNode.prototype.disconnect,AudioNode.prototype.connect!==r&&(AudioNode.prototype.connect=r,AudioNode.prototype.disconnect=function(l,d,_){if(l&&l.input&&Array.isArray(l.input))o.prototype.isUndef(_)&&(_=0),this.disconnect(l.input[_],d,_);else if(l&&l.input)this.disconnect(l.input,d,_);else try{c.apply(this,arguments)}catch(w){throw new Error("error disconnecting node: "+l+`
`+w)}}),o.context=new o.Context):console.warn("This browser does not support Tone.js"),o.Context}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(4),h(20),h(2),h(10)],f=(function(o){return o.Subtract=function(r){this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new o.Gain,this._neg=new o.Negate,this._param=this.input[1]=new o.Signal(r),this._param.chain(this._neg,this._sum)},o.extend(o.Subtract,o.Signal),o.Subtract.prototype.dispose=function(){return o.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},o.Subtract}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0)],f=(function(o){return o.Emitter=function(){this._events={}},o.extend(o.Emitter),o.Emitter.prototype.on=function(r,a){for(var c=r.split(/\W+/),l=0;l<c.length;l++){var d=c[l];this._events.hasOwnProperty(d)||(this._events[d]=[]),this._events[d].push(a)}return this},o.Emitter.prototype.off=function(r,a){for(var c=r.split(/\W+/),l=0;l<c.length;l++)if(r=c[l],this._events.hasOwnProperty(r))if(o.prototype.isUndef(a))this._events[r]=[];else for(var d=this._events[r],_=0;_<d.length;_++)d[_]===a&&d.splice(_,1);return this},o.Emitter.prototype.emit=function(r){if(this._events){var a=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(r))for(var c=this._events[r],l=0,d=c.length;l<d;l++)c[l].apply(this,a)}return this},o.Emitter.mixin=function(r){var a=["on","off","emit"];r._events={};for(var c=0;c<a.length;c++){var l=a[c],d=o.Emitter.prototype[l];r[l]=d}},o.Emitter.prototype.dispose=function(){return o.prototype.dispose.call(this),this._events=null,this},o.Emitter}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0)],f=(function(o){return o.SignalBase=function(){},o.extend(o.SignalBase),o.SignalBase.prototype.connect=function(r,a,c){return o.Signal&&o.Signal===r.constructor||o.Param&&o.Param===r.constructor||o.TimelineSignal&&o.TimelineSignal===r.constructor?(r._param.cancelScheduledValues(0),r._param.value=0,r.overridden=!0):r instanceof AudioParam&&(r.cancelScheduledValues(0),r.value=0),o.prototype.connect.call(this,r,a,c),this},o.SignalBase}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(17)],f=(function(o){return o.Time=function(r,a){if(!(this instanceof o.Time))return new o.Time(r,a);this._plusNow=!1,o.TimeBase.call(this,r,a)},o.extend(o.Time,o.TimeBase),o.Time.prototype._unaryExpressions=Object.create(o.TimeBase.prototype._unaryExpressions),o.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(r){return o.Transport.nextSubdivision(r())}},o.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(r){return this._plusNow=!0,r()}},o.Time.prototype.quantize=function(r,a){return a=this.defaultArg(a,1),this._expr=(function(c,l,d){return c=c(),l=l.toSeconds(),c+(Math.round(c/l)*l-c)*d}).bind(this,this._expr,new this.constructor(r),a),this},o.Time.prototype.addNow=function(){return this._plusNow=!0,this},o.Time.prototype._defaultExpr=function(){return this._plusNow=!0,this._noOp},o.Time.prototype.copy=function(r){return o.TimeBase.prototype.copy.call(this,r),this._plusNow=r._plusNow,this},o.Time.prototype.toNotation=function(){var r=this.toSeconds(),a=this._toNotationHelper(r,["1m","2n","4n","8n","16n","32n","64n","128n"]),c=this._toNotationHelper(r,["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"]);return c.split("+").length<a.split("+").length?c:a},o.Time.prototype._toNotationHelper=function(r,a){for(var c=this._notationToUnits(a[a.length-1]),l="",d=0;d<a.length;d++){var _=this._notationToUnits(a[d]),w=r/_;if(1-w%1<1e-6&&(w+=1e-6),0<(w=Math.floor(w))){if(l+=w===1?a[d]:w.toString()+"*"+a[d],(r-=w*_)<c)break;l+=" + "}}return l===""&&(l="0"),l},o.Time.prototype._notationToUnits=function(r){for(var a=this._primaryExpressions,c=[a.n,a.t,a.m],l=0;l<c.length;l++){var d=c[l],_=r.match(d.regexp);if(_)return d.method.call(this,_[1])}},o.Time.prototype.toBarsBeatsSixteenths=function(){var r=this._beatsToUnits(1),a=this.toSeconds()/r,c=Math.floor(a/this._timeSignature()),l=a%1*4;return a=Math.floor(a)%this._timeSignature(),3<(l=l.toString()).length&&(l=parseFloat(l).toFixed(3)),[c,a,l].join(":")},o.Time.prototype.toTicks=function(){var r=this._beatsToUnits(1),a=this.valueOf()/r;return Math.floor(a*o.Transport.PPQ)},o.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},o.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},o.Time.prototype.toSeconds=function(){return this.valueOf()},o.Time.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},o.Time.prototype.valueOf=function(){return this._expr()+(this._plusNow?this.now():0)},o.Time}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0)],f=(function(o){return o.TimeBase=function(r,a){if(!(this instanceof o.TimeBase))return new o.TimeBase(r,a);if(this._expr=this._noOp,r instanceof o.TimeBase)this.copy(r);else if(!this.isUndef(a)||this.isNumber(r)){a=this.defaultArg(a,this._defaultUnits);var c=this._primaryExpressions[a].method;this._expr=c.bind(this,r)}else this.isString(r)?this.set(r):this.isUndef(r)&&(this._expr=this._defaultExpr())},o.extend(o.TimeBase),o.TimeBase.prototype.set=function(r){return this._expr=this._parseExprString(r),this},o.TimeBase.prototype.clone=function(){var r=new this.constructor;return r.copy(this),r},o.TimeBase.prototype.copy=function(r){var a=r._expr();return this.set(a)},o.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(r){return(r=parseInt(r))===1?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/r)}},t:{regexp:/^(\d+)t/i,method:function(r){return r=parseInt(r),this._beatsToUnits(8/(3*parseInt(r)))}},m:{regexp:/^(\d+)m/i,method:function(r){return this._beatsToUnits(parseInt(r)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(r){return this._ticksToUnits(parseInt(r))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(r){return this._frequencyToUnits(parseFloat(r))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(r,a,c){var l=0;return r&&r!=="0"&&(l+=this._beatsToUnits(this._timeSignature()*parseFloat(r))),a&&a!=="0"&&(l+=this._beatsToUnits(parseFloat(a))),c&&c!=="0"&&(l+=this._beatsToUnits(parseFloat(c)/4)),l}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(r){return this._secondsToUnits(parseFloat(r))}},samples:{regexp:/^(\d+)samples/,method:function(r){return parseInt(r)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)/,method:function(r){return this._primaryExpressions[this._defaultUnits].method.call(this,r)}}},o.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(r,a){return r()+a()}},"-":{regexp:/^\-/,precedence:2,method:function(r,a){return r()-a()}},"*":{regexp:/^\*/,precedence:1,method:function(r,a){return r()*a()}},"/":{regexp:/^\//,precedence:1,method:function(r,a){return r()/a()}}},o.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(r){return-r()}}},o.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},o.TimeBase.prototype._tokenize=function(r){for(var a=-1,c=[];0<r.length;){var l=d(r=r.trim(),this);c.push(l),r=r.substr(l.value.length)}function d(_,w){for(var S=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"],k=0;k<S.length;k++){var A=w[S[k]];for(var R in A){var O=A[R],N=O.regexp,E=_.match(N);if(E!==null)return{method:O.method,precedence:O.precedence,regexp:O.regexp,value:E[0]}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+_)}return{next:function(){return c[++a]},peek:function(){return c[a+1]}}},o.TimeBase.prototype._matchGroup=function(r,a,c){if(!this.isUndef(r))for(var l in a){var d=a[l];if(d.regexp.test(r.value)&&(this.isUndef(c)||d.precedence===c))return d}return!1},o.TimeBase.prototype._parseBinary=function(r,a){var c;this.isUndef(a)&&(a=2),c=a<0?this._parseUnary(r):this._parseBinary(r,a-1);for(var l=r.peek();l&&this._matchGroup(l,this._binaryExpressions,a);)c=(l=r.next()).method.bind(this,c,this._parseBinary(r,a-1)),l=r.peek();return c},o.TimeBase.prototype._parseUnary=function(r){var a,c;a=r.peek();var l=this._matchGroup(a,this._unaryExpressions);return l?(a=r.next(),c=this._parseUnary(r),l.method.bind(this,c)):this._parsePrimary(r)},o.TimeBase.prototype._parsePrimary=function(r){var a,c;if(a=r.peek(),this.isUndef(a))throw new SyntaxError("Tone.TimeBase: Unexpected end of expression");if(this._matchGroup(a,this._primaryExpressions)){var l=(a=r.next()).value.match(a.regexp);return a.method.bind(this,l[1],l[2],l[3])}if(a&&a.value==="("){if(r.next(),c=this._parseBinary(r),!(a=r.next())||a.value!==")")throw new SyntaxError("Expected )");return c}throw new SyntaxError("Tone.TimeBase: Cannot process token "+a.value)},o.TimeBase.prototype._parseExprString=function(r){this.isString(r)||(r=r.toString());var a=this._tokenize(r);return this._parseBinary(a)},o.TimeBase.prototype._noOp=function(){return 0},o.TimeBase.prototype._defaultExpr=function(){return this._noOp},o.TimeBase.prototype._defaultUnits="s",o.TimeBase.prototype._frequencyToUnits=function(r){return 1/r},o.TimeBase.prototype._beatsToUnits=function(r){return 60/o.Transport.bpm.value*r},o.TimeBase.prototype._secondsToUnits=function(r){return r},o.TimeBase.prototype._ticksToUnits=function(r){return r*(this._beatsToUnits(1)/o.Transport.PPQ)},o.TimeBase.prototype._timeSignature=function(){return o.Transport.timeSignature},o.TimeBase.prototype._pushExpr=function(r,a,c){return r instanceof o.TimeBase||(r=new this.constructor(r,c)),this._expr=this._binaryExpressions[a].method.bind(this,this._expr,r._expr),this},o.TimeBase.prototype.add=function(r,a){return this._pushExpr(r,"+",a)},o.TimeBase.prototype.sub=function(r,a){return this._pushExpr(r,"-",a)},o.TimeBase.prototype.mult=function(r,a){return this._pushExpr(r,"*",a)},o.TimeBase.prototype.div=function(r,a){return this._pushExpr(r,"/",a)},o.TimeBase.prototype.valueOf=function(){return this._expr()},o.TimeBase.prototype.dispose=function(){this._expr=null},o.TimeBase}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(9)],f=(function(o){return o.Param=function(){var r=this.optionsObject(arguments,["param","units","convert"],o.Param.defaults);this._param=this.input=r.param,this.units=r.units,this.convert=r.convert,this.overridden=!1,this._lfo=null,this.isObject(r.lfo)?this.value=r.lfo:this.isUndef(r.value)||(this.value=r.value)},o.extend(o.Param),o.Param.defaults={units:o.Type.Default,convert:!0,param:void 0},Object.defineProperty(o.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(r){if(this.isObject(r)){if(this.isUndef(o.LFO))throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.");this._lfo&&this._lfo.dispose(),this._lfo=new o.LFO(r).start(),this._lfo.connect(this.input)}else{var a=this._fromUnits(r);this._param.cancelScheduledValues(0),this._param.value=a}}}),o.Param.prototype._fromUnits=function(r){if(!this.convert&&!this.isUndef(this.convert))return r;switch(this.units){case o.Type.Time:return this.toSeconds(r);case o.Type.Frequency:return this.toFrequency(r);case o.Type.Decibels:return this.dbToGain(r);case o.Type.NormalRange:return Math.min(Math.max(r,0),1);case o.Type.AudioRange:return Math.min(Math.max(r,-1),1);case o.Type.Positive:return Math.max(r,0);default:return r}},o.Param.prototype._toUnits=function(r){if(!this.convert&&!this.isUndef(this.convert))return r;switch(this.units){case o.Type.Decibels:return this.gainToDb(r);default:return r}},o.Param.prototype._minOutput=1e-5,o.Param.prototype.setValueAtTime=function(r,a){return r=this._fromUnits(r),(a=this.toSeconds(a))<=this.now()+this.blockTime?this._param.value=r:this._param.setValueAtTime(r,a),this},o.Param.prototype.setRampPoint=function(r){r=this.defaultArg(r,this.now());var a=this._param.value;return a===0&&(a=this._minOutput),this._param.setValueAtTime(a,r),this},o.Param.prototype.linearRampToValueAtTime=function(r,a){return r=this._fromUnits(r),this._param.linearRampToValueAtTime(r,this.toSeconds(a)),this},o.Param.prototype.exponentialRampToValueAtTime=function(r,a){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),this._param.exponentialRampToValueAtTime(r,this.toSeconds(a)),this},o.Param.prototype.exponentialRampToValue=function(r,a,c){return c=this.toSeconds(c),this.setRampPoint(c),this.exponentialRampToValueAtTime(r,c+this.toSeconds(a)),this},o.Param.prototype.linearRampToValue=function(r,a,c){return c=this.toSeconds(c),this.setRampPoint(c),this.linearRampToValueAtTime(r,c+this.toSeconds(a)),this},o.Param.prototype.setTargetAtTime=function(r,a,c){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),c=Math.max(this._minOutput,c),this._param.setTargetAtTime(r,this.toSeconds(a),c),this},o.Param.prototype.setValueCurveAtTime=function(r,a,c){for(var l=0;l<r.length;l++)r[l]=this._fromUnits(r[l]);return this._param.setValueCurveAtTime(r,this.toSeconds(a),this.toSeconds(c)),this},o.Param.prototype.cancelScheduledValues=function(r){return this._param.cancelScheduledValues(this.toSeconds(r)),this},o.Param.prototype.rampTo=function(r,a,c){return a=this.defaultArg(a,0),this.units===o.Type.Frequency||this.units===o.Type.BPM||this.units===o.Type.Decibels?this.exponentialRampToValue(r,a,c):this.linearRampToValue(r,a,c),this},Object.defineProperty(o.Param.prototype,"lfo",{get:function(){return this._lfo}}),o.Param.prototype.dispose=function(){return o.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},o.Param}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(9)],f=(function(o){return o.Timeline=function(){var r=this.optionsObject(arguments,["memory"],o.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=r.memory},o.extend(o.Timeline),o.Timeline.defaults={memory:1/0},Object.defineProperty(o.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),o.Timeline.prototype.add=function(r){if(this.isUndef(r.time))throw new Error("Tone.Timeline: events must have a time attribute");if(this._timeline.length){var a=this._search(r.time);this._timeline.splice(a+1,0,r)}else this._timeline.push(r);if(this.length>this.memory){var c=this.length-this.memory;this._timeline.splice(0,c)}return this},o.Timeline.prototype.remove=function(r){if(this._iterating)this._toRemove.push(r);else{var a=this._timeline.indexOf(r);a!==-1&&this._timeline.splice(a,1)}return this},o.Timeline.prototype.get=function(r){var a=this._search(r);return a!==-1?this._timeline[a]:null},o.Timeline.prototype.peek=function(){return this._timeline[0]},o.Timeline.prototype.shift=function(){return this._timeline.shift()},o.Timeline.prototype.getAfter=function(r){var a=this._search(r);return a+1<this._timeline.length?this._timeline[a+1]:null},o.Timeline.prototype.getBefore=function(r){var a=this._timeline.length;if(0<a&&this._timeline[a-1].time<r)return this._timeline[a-1];var c=this._search(r);return 0<=c-1?this._timeline[c-1]:null},o.Timeline.prototype.cancel=function(r){if(1<this._timeline.length){var a=this._search(r);if(0<=a)if(this._timeline[a].time===r){for(var c=a;0<=c&&this._timeline[c].time===r;c--)a=c;this._timeline=this._timeline.slice(0,a)}else this._timeline=this._timeline.slice(0,a+1);else this._timeline=[]}else this._timeline.length===1&&this._timeline[0].time>=r&&(this._timeline=[]);return this},o.Timeline.prototype.cancelBefore=function(r){if(this._timeline.length){var a=this._search(r);0<=a&&(this._timeline=this._timeline.slice(a+1))}return this},o.Timeline.prototype._search=function(r){var a=0,c=this._timeline.length,l=c;if(0<c&&this._timeline[c-1].time<=r)return c-1;for(;a<l;){var d=Math.floor(a+(l-a)/2),_=this._timeline[d],w=this._timeline[d+1];if(_.time===r){for(var S=d;S<this._timeline.length;S++)this._timeline[S].time===r&&(d=S);return d}if(_.time<r&&w.time>r)return d;_.time>r?l=d:_.time<r&&(a=d+1)}return-1},o.Timeline.prototype._iterate=function(r,a,c){this._iterating=!0,a=this.defaultArg(a,0),c=this.defaultArg(c,this._timeline.length-1);for(var l=a;l<=c;l++)r(this._timeline[l]);if(this._iterating=!1,0<this._toRemove.length){for(var d=0;d<this._toRemove.length;d++){var _=this._timeline.indexOf(this._toRemove[d]);_!==-1&&this._timeline.splice(_,1)}this._toRemove=[]}},o.Timeline.prototype.forEach=function(r){return this._iterate(r),this},o.Timeline.prototype.forEachBefore=function(r,a){var c=this._search(r);return c!==-1&&this._iterate(a,0,c),this},o.Timeline.prototype.forEachAfter=function(r,a){var c=this._search(r);return this._iterate(a,c+1),this},o.Timeline.prototype.forEachFrom=function(r,a){for(var c=this._search(r);0<=c&&this._timeline[c].time>=r;)c--;return this._iterate(a,c+1),this},o.Timeline.prototype.forEachAtTime=function(r,a){var c=this._search(r);return c!==-1&&this._iterate(function(l){l.time===r&&a(l)},0,c),this},o.Timeline.prototype.dispose=function(){o.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},o.Timeline}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(1),h(2)],f=(function(o){return o.Negate=function(){this._multiply=this.input=this.output=new o.Multiply(-1)},o.extend(o.Negate,o.SignalBase),o.Negate.prototype.dispose=function(){return o.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},o.Negate}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(2),h(1),h(6)],f=(function(o){return o.GreaterThanZero=function(){this._thresh=this.output=new o.WaveShaper(function(r){return r<=0?0:1},127),this._scale=this.input=new o.Multiply(1e4),this._scale.connect(this._thresh)},o.extend(o.GreaterThanZero,o.SignalBase),o.GreaterThanZero.prototype.dispose=function(){return o.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},o.GreaterThanZero}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f,o;(function(r,a){f=[],g=a,o=typeof g=="function"?g.apply(T,f):g,o!==void 0&&(y.exports=o)})(this,function(){var r=function(c,l){this._dragged=!1,this._element=c,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,l),c.addEventListener("touchstart",this._bindedEnd),c.addEventListener("touchmove",this._bindedMove),c.addEventListener("touchend",this._bindedEnd),c.addEventListener("mouseup",this._bindedEnd)};function a(c){return c.state==="running"}return r.prototype._moved=function(c){this._dragged=!0},r.prototype._ended=function(c){this._dragged||function(l){var d=l.createBuffer(1,1,l.sampleRate),_=l.createBufferSource();_.buffer=d,_.connect(l.destination),_.start(0),l.resume&&l.resume()}(c),this._dragged=!1},r.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null},function(c,l,d){var _=new Promise(function(S){(function(k,A){a(k)?A():function R(){a(k)?A():(requestAnimationFrame(R),k.resume&&k.resume())}()})(c,S)}),w=[];return function S(k,A,R){if(Array.isArray(k)||NodeList&&k instanceof NodeList)for(var O=0;O<k.length;O++)S(k[O],A,R);else if(typeof k=="string")S(document.querySelectorAll(k),A,R);else if(k.jquery&&typeof k.toArray=="function")S(k.toArray(),A,R);else if(Element&&k instanceof Element){var N=new r(k,R);A.push(N)}}(l=l||document.body,w,c),_.then(function(){for(var S=0;S<w.length;S++)w[S].dispose();w=null,d&&d()}),_}})},function(y,T,h){var g,f;g=[h(0),h(2),h(32),h(38),h(10)],f=(function(o){return o.CrossFade=function(r){this.createInsOuts(2,1),this.a=this.input[0]=new o.Gain,this.b=this.input[1]=new o.Gain,this.fade=new o.Signal(this.defaultArg(r,.5),o.Type.NormalRange),this._equalPowerA=new o.EqualPowerGain,this._equalPowerB=new o.EqualPowerGain,this._invert=new o.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain),this._readOnly("fade")},o.extend(o.CrossFade),o.CrossFade.prototype.dispose=function(){return o.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},o.CrossFade}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T){(function(){var h,g=[];function f(c){var l=this,d={},_=-1;this.parameters.forEach(function(k,A){var R=g[++_]||(g[_]=new Float32Array(l.bufferSize));R.fill(k.value),d[A]=R}),this.processor.realm.exec("self.sampleRate=sampleRate="+this.context.sampleRate+";self.currentTime=currentTime="+this.context.currentTime);var w=o(c.inputBuffer),S=o(c.outputBuffer);this.instance.process([w],[S],d)}function o(c){for(var l=[],d=0;d<c.numberOfChannels;d++)l[d]=c.getChannelData(d);return l}function r(c){return c.$$processors||(c.$$processors={})}function a(c){this.$$context=c}typeof AudioWorkletNode!="function"&&(self.AudioWorkletNode=function(c,l,d){var _=r(c)[l],w=c.createScriptProcessor(void 0,2,d&&d.outputChannelCount?d.outputChannelCount[0]:2);if(w.parameters=new Map,_.properties)for(var S=0;S<_.properties.length;S++){var k=_.properties[S],A=c.createGain().gain;A.value=k.defaultValue,w.parameters.set(k.name,A)}var R=new MessageChannel;h=R.port2;var O=new _.Processor(d||{});return h=null,w.port=R.port1,w.processor=_,w.instance=O,w.onaudioprocess=f,w},Object.defineProperty((self.AudioContext||self.webkitAudioContext).prototype,"audioWorklet",{get:function(){return this.$$audioWorklet||(this.$$audioWorklet=new self.AudioWorklet(this))}}),self.AudioWorklet=(a.prototype.addModule=function(c,l){var d=this;return fetch(c).then(function(_){if(!_.ok)throw Error(_.status);return _.text()}).then(function(_){var w={sampleRate:0,currentTime:0,AudioWorkletProcessor:function(){this.port=h},registerProcessor:function(k,A){r(d.$$context)[k]={realm:S,context:w,Processor:A,properties:A.parameterDescriptors||[]}}},S=new function(k,A){var R=document.createElement("iframe");R.style.cssText="position:absolute;left:0;top:-999px;width:1px;height:1px;",A.appendChild(R);var O=R.contentWindow,N=O.document,E="var window,$hook";for(var M in O)M in k||M==="eval"||(E+=",",E+=M);for(var D in k)E+=",",E+=D,E+="=self.",E+=D;var I=N.createElement("script");I.appendChild(N.createTextNode(`function $hook(self,console) {"use strict";
        `+E+";return function() {return eval(arguments[0])}}")),N.body.appendChild(I),this.exec=O.$hook(k,console)}(w.self=w,document.documentElement);return S.exec((l&&l.transpile||String)(_)),null})},a))})()},function(y,T){(function(){function c(l){l&&(l.setTargetAtTime||(l.setTargetAtTime=l.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=window.webkitAudioContext,typeof AudioContext.prototype.createGain!="function"&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),typeof AudioContext.prototype.createDelay!="function"&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),typeof AudioContext.prototype.createScriptProcessor!="function"&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),typeof AudioContext.prototype.createPeriodicWave!="function"&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var l=this.internal_createGain();return c(l.gain),l},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(l){var d=l?this.internal_createDelay(l):this.internal_createDelay();return c(d.delayTime),d},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var l=this.internal_createBufferSource();return l.start?(l.internal_start=l.start,l.start=function(d,_,w){typeof w<"u"?l.internal_start(d||0,_,w):l.internal_start(d||0,_||0)}):l.start=function(d,_,w){_||w?this.noteGrainOn(d||0,_,w):this.noteOn(d||0)},l.stop?(l.internal_stop=l.stop,l.stop=function(d){l.internal_stop(d||0)}):l.stop=function(d){this.noteOff(d||0)},c(l.playbackRate),l},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var l=this.internal_createDynamicsCompressor();return c(l.threshold),c(l.knee),c(l.ratio),c(l.reduction),c(l.attack),c(l.release),l},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var l=this.internal_createBiquadFilter();return c(l.frequency),c(l.detune),c(l.Q),c(l.gain),l},typeof AudioContext.prototype.createOscillator!="function"&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var l=this.internal_createOscillator();return l.start?(l.internal_start=l.start,l.start=function(d){l.internal_start(d||0)}):l.start=function(d){this.noteOn(d||0)},l.stop?(l.internal_stop=l.stop,l.stop=function(d){l.internal_stop(d||0)}):l.stop=function(d){this.noteOff(d||0)},l.setPeriodicWave||(l.setPeriodicWave=l.setWaveTable),c(l.frequency),c(l.detune),l})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext)})(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var h=document.createElement("audio");p5.prototype.isSupported=function(){return!!h.canPlayType};var g=function(){return!!h.canPlayType&&h.canPlayType('audio/ogg; codecs="vorbis"')},f=function(){return!!h.canPlayType&&h.canPlayType("audio/mpeg;")},o=function(){return!!h.canPlayType&&h.canPlayType('audio/wav; codecs="1"')},r=function(){return!!h.canPlayType&&(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/aac;"))},a=function(){return!!h.canPlayType&&h.canPlayType("audio/x-aiff;")};p5.prototype.isFileSupported=function(c){switch(c.toLowerCase()){case"mp3":return f();case"wav":return o();case"ogg":return g();case"aac":case"m4a":case"mp4":return r();case"aif":case"aiff":return a();default:return!1}}},function(y,T){var h;h=function(){return this}();try{h=h||new Function("return this")()}catch{typeof window=="object"&&(h=window)}y.exports=h},function(y,T,h){h.r(T),T.default=`function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }

function isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }

function _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

// import dependencies via preval.require so that they're available as values at compile time
var processorNames = {
  "recorderProcessor": "recorder-processor",
  "soundFileProcessor": "sound-file-processor",
  "amplitudeProcessor": "amplitude-processor"
};
var RingBuffer = {
  "default":
  /*#__PURE__*/
  function () {
    /**
     * @constructor
     * @param  {number} length Buffer length in frames.
     * @param  {number} channelCount Buffer channel count.
     */
    function RingBuffer(length, channelCount) {
      _classCallCheck(this, RingBuffer);

      this._readIndex = 0;
      this._writeIndex = 0;
      this._framesAvailable = 0;
      this._channelCount = channelCount;
      this._length = length;
      this._channelData = [];

      for (var i = 0; i < this._channelCount; ++i) {
        this._channelData[i] = new Float32Array(length);
      }
    }
    /**
     * Getter for Available frames in buffer.
     *
     * @return {number} Available frames in buffer.
     */


    _createClass(RingBuffer, [{
      key: "push",

      /**
       * Push a sequence of Float32Arrays to buffer.
       *
       * @param  {array} arraySequence A sequence of Float32Arrays.
       */
      value: function push(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // Transfer data from the |arraySequence| storage to the internal buffer.
        var sourceLength = arraySequence[0] ? arraySequence[0].length : 0;

        for (var i = 0; i < sourceLength; ++i) {
          var writeIndex = (this._writeIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            this._channelData[channel][writeIndex] = arraySequence[channel][i];
          }
        }

        this._writeIndex += sourceLength;

        if (this._writeIndex >= this._length) {
          this._writeIndex = 0;
        } // For excessive frames, the buffer will be overwritten.


        this._framesAvailable += sourceLength;

        if (this._framesAvailable > this._length) {
          this._framesAvailable = this._length;
        }
      }
      /**
       * Pull data out of buffer and fill a given sequence of Float32Arrays.
       *
       * @param  {array} arraySequence An array of Float32Arrays.
       */

    }, {
      key: "pull",
      value: function pull(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // If the FIFO is completely empty, do nothing.
        if (this._framesAvailable === 0) {
          return;
        }

        var destinationLength = arraySequence[0].length; // Transfer data from the internal buffer to the |arraySequence| storage.

        for (var i = 0; i < destinationLength; ++i) {
          var readIndex = (this._readIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            arraySequence[channel][i] = this._channelData[channel][readIndex];
          }
        }

        this._readIndex += destinationLength;

        if (this._readIndex >= this._length) {
          this._readIndex = 0;
        }

        this._framesAvailable -= destinationLength;

        if (this._framesAvailable < 0) {
          this._framesAvailable = 0;
        }
      }
    }, {
      key: "framesAvailable",
      get: function get() {
        return this._framesAvailable;
      }
    }]);

    return RingBuffer;
  }()
}["default"];

var RecorderProcessor =
/*#__PURE__*/
function (_AudioWorkletProcesso) {
  _inherits(RecorderProcessor, _AudioWorkletProcesso);

  function RecorderProcessor(options) {
    var _this;

    _classCallCheck(this, RecorderProcessor);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(RecorderProcessor).call(this));
    var processorOptions = options.processorOptions || {};
    _this.numOutputChannels = options.outputChannelCount || 2;
    _this.numInputChannels = processorOptions.numInputChannels || 2;
    _this.bufferSize = processorOptions.bufferSize || 1024;
    _this.recording = false;

    _this.clear();

    _this.port.onmessage = function (event) {
      var data = event.data;

      if (data.name === 'start') {
        _this.record(data.duration);
      } else if (data.name === 'stop') {
        _this.stop();
      }
    };

    return _this;
  }

  _createClass(RecorderProcessor, [{
    key: "process",
    value: function process(inputs) {
      if (!this.recording) {
        return true;
      } else if (this.sampleLimit && this.recordedSamples >= this.sampleLimit) {
        this.stop();
        return true;
      }

      var input = inputs[0];
      this.inputRingBuffer.push(input);

      if (this.inputRingBuffer.framesAvailable >= this.bufferSize) {
        this.inputRingBuffer.pull(this.inputRingBufferArraySequence);

        for (var channel = 0; channel < this.numOutputChannels; ++channel) {
          var inputChannelCopy = this.inputRingBufferArraySequence[channel].slice();

          if (channel === 0) {
            this.leftBuffers.push(inputChannelCopy);

            if (this.numInputChannels === 1) {
              this.rightBuffers.push(inputChannelCopy);
            }
          } else if (channel === 1 && this.numInputChannels > 1) {
            this.rightBuffers.push(inputChannelCopy);
          }
        }

        this.recordedSamples += this.bufferSize;
      }

      return true;
    }
  }, {
    key: "record",
    value: function record(duration) {
      if (duration) {
        this.sampleLimit = Math.round(duration * sampleRate);
      }

      this.recording = true;
    }
  }, {
    key: "stop",
    value: function stop() {
      this.recording = false;
      var buffers = this.getBuffers();
      var leftBuffer = buffers[0].buffer;
      var rightBuffer = buffers[1].buffer;
      this.port.postMessage({
        name: 'buffers',
        leftBuffer: leftBuffer,
        rightBuffer: rightBuffer
      }, [leftBuffer, rightBuffer]);
      this.clear();
    }
  }, {
    key: "getBuffers",
    value: function getBuffers() {
      var buffers = [];
      buffers.push(this.mergeBuffers(this.leftBuffers));
      buffers.push(this.mergeBuffers(this.rightBuffers));
      return buffers;
    }
  }, {
    key: "mergeBuffers",
    value: function mergeBuffers(channelBuffer) {
      var result = new Float32Array(this.recordedSamples);
      var offset = 0;
      var lng = channelBuffer.length;

      for (var i = 0; i < lng; i++) {
        var buffer = channelBuffer[i];
        result.set(buffer, offset);
        offset += buffer.length;
      }

      return result;
    }
  }, {
    key: "clear",
    value: function clear() {
      var _this2 = this;

      this.leftBuffers = [];
      this.rightBuffers = [];
      this.inputRingBuffer = new RingBuffer(this.bufferSize, this.numInputChannels);
      this.inputRingBufferArraySequence = new Array(this.numInputChannels).fill(null).map(function () {
        return new Float32Array(_this2.bufferSize);
      });
      this.recordedSamples = 0;
      this.sampleLimit = null;
    }
  }]);

  return RecorderProcessor;
}(_wrapNativeSuper(AudioWorkletProcessor));

registerProcessor(processorNames.recorderProcessor, RecorderProcessor);`},function(y,T,h){h.r(T),T.default=`function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }

function isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }

function _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

// import dependencies via preval.require so that they're available as values at compile time
var processorNames = {
  "recorderProcessor": "recorder-processor",
  "soundFileProcessor": "sound-file-processor",
  "amplitudeProcessor": "amplitude-processor"
};
var RingBuffer = {
  "default":
  /*#__PURE__*/
  function () {
    /**
     * @constructor
     * @param  {number} length Buffer length in frames.
     * @param  {number} channelCount Buffer channel count.
     */
    function RingBuffer(length, channelCount) {
      _classCallCheck(this, RingBuffer);

      this._readIndex = 0;
      this._writeIndex = 0;
      this._framesAvailable = 0;
      this._channelCount = channelCount;
      this._length = length;
      this._channelData = [];

      for (var i = 0; i < this._channelCount; ++i) {
        this._channelData[i] = new Float32Array(length);
      }
    }
    /**
     * Getter for Available frames in buffer.
     *
     * @return {number} Available frames in buffer.
     */


    _createClass(RingBuffer, [{
      key: "push",

      /**
       * Push a sequence of Float32Arrays to buffer.
       *
       * @param  {array} arraySequence A sequence of Float32Arrays.
       */
      value: function push(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // Transfer data from the |arraySequence| storage to the internal buffer.
        var sourceLength = arraySequence[0] ? arraySequence[0].length : 0;

        for (var i = 0; i < sourceLength; ++i) {
          var writeIndex = (this._writeIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            this._channelData[channel][writeIndex] = arraySequence[channel][i];
          }
        }

        this._writeIndex += sourceLength;

        if (this._writeIndex >= this._length) {
          this._writeIndex = 0;
        } // For excessive frames, the buffer will be overwritten.


        this._framesAvailable += sourceLength;

        if (this._framesAvailable > this._length) {
          this._framesAvailable = this._length;
        }
      }
      /**
       * Pull data out of buffer and fill a given sequence of Float32Arrays.
       *
       * @param  {array} arraySequence An array of Float32Arrays.
       */

    }, {
      key: "pull",
      value: function pull(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // If the FIFO is completely empty, do nothing.
        if (this._framesAvailable === 0) {
          return;
        }

        var destinationLength = arraySequence[0].length; // Transfer data from the internal buffer to the |arraySequence| storage.

        for (var i = 0; i < destinationLength; ++i) {
          var readIndex = (this._readIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            arraySequence[channel][i] = this._channelData[channel][readIndex];
          }
        }

        this._readIndex += destinationLength;

        if (this._readIndex >= this._length) {
          this._readIndex = 0;
        }

        this._framesAvailable -= destinationLength;

        if (this._framesAvailable < 0) {
          this._framesAvailable = 0;
        }
      }
    }, {
      key: "framesAvailable",
      get: function get() {
        return this._framesAvailable;
      }
    }]);

    return RingBuffer;
  }()
}["default"];

var SoundFileProcessor =
/*#__PURE__*/
function (_AudioWorkletProcesso) {
  _inherits(SoundFileProcessor, _AudioWorkletProcesso);

  function SoundFileProcessor(options) {
    var _this;

    _classCallCheck(this, SoundFileProcessor);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(SoundFileProcessor).call(this));
    var processorOptions = options.processorOptions || {};
    _this.bufferSize = processorOptions.bufferSize || 256;
    _this.inputRingBuffer = new RingBuffer(_this.bufferSize, 1);
    _this.inputRingBufferArraySequence = [new Float32Array(_this.bufferSize)];
    return _this;
  }

  _createClass(SoundFileProcessor, [{
    key: "process",
    value: function process(inputs) {
      var input = inputs[0]; // we only care about the first input channel, because that contains the position data

      this.inputRingBuffer.push([input[0]]);

      if (this.inputRingBuffer.framesAvailable >= this.bufferSize) {
        this.inputRingBuffer.pull(this.inputRingBufferArraySequence);
        var inputChannel = this.inputRingBufferArraySequence[0];
        var position = inputChannel[inputChannel.length - 1] || 0;
        this.port.postMessage({
          name: 'position',
          position: position
        });
      }

      return true;
    }
  }]);

  return SoundFileProcessor;
}(_wrapNativeSuper(AudioWorkletProcessor));

registerProcessor(processorNames.soundFileProcessor, SoundFileProcessor);`},function(y,T,h){h.r(T),T.default=`function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }

function isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }

function _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

// import dependencies via preval.require so that they're available as values at compile time
var processorNames = {
  "recorderProcessor": "recorder-processor",
  "soundFileProcessor": "sound-file-processor",
  "amplitudeProcessor": "amplitude-processor"
};
var RingBuffer = {
  "default":
  /*#__PURE__*/
  function () {
    /**
     * @constructor
     * @param  {number} length Buffer length in frames.
     * @param  {number} channelCount Buffer channel count.
     */
    function RingBuffer(length, channelCount) {
      _classCallCheck(this, RingBuffer);

      this._readIndex = 0;
      this._writeIndex = 0;
      this._framesAvailable = 0;
      this._channelCount = channelCount;
      this._length = length;
      this._channelData = [];

      for (var i = 0; i < this._channelCount; ++i) {
        this._channelData[i] = new Float32Array(length);
      }
    }
    /**
     * Getter for Available frames in buffer.
     *
     * @return {number} Available frames in buffer.
     */


    _createClass(RingBuffer, [{
      key: "push",

      /**
       * Push a sequence of Float32Arrays to buffer.
       *
       * @param  {array} arraySequence A sequence of Float32Arrays.
       */
      value: function push(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // Transfer data from the |arraySequence| storage to the internal buffer.
        var sourceLength = arraySequence[0] ? arraySequence[0].length : 0;

        for (var i = 0; i < sourceLength; ++i) {
          var writeIndex = (this._writeIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            this._channelData[channel][writeIndex] = arraySequence[channel][i];
          }
        }

        this._writeIndex += sourceLength;

        if (this._writeIndex >= this._length) {
          this._writeIndex = 0;
        } // For excessive frames, the buffer will be overwritten.


        this._framesAvailable += sourceLength;

        if (this._framesAvailable > this._length) {
          this._framesAvailable = this._length;
        }
      }
      /**
       * Pull data out of buffer and fill a given sequence of Float32Arrays.
       *
       * @param  {array} arraySequence An array of Float32Arrays.
       */

    }, {
      key: "pull",
      value: function pull(arraySequence) {
        // The channel count of arraySequence and the length of each channel must
        // match with this buffer obejct.
        // If the FIFO is completely empty, do nothing.
        if (this._framesAvailable === 0) {
          return;
        }

        var destinationLength = arraySequence[0].length; // Transfer data from the internal buffer to the |arraySequence| storage.

        for (var i = 0; i < destinationLength; ++i) {
          var readIndex = (this._readIndex + i) % this._length;

          for (var channel = 0; channel < this._channelCount; ++channel) {
            arraySequence[channel][i] = this._channelData[channel][readIndex];
          }
        }

        this._readIndex += destinationLength;

        if (this._readIndex >= this._length) {
          this._readIndex = 0;
        }

        this._framesAvailable -= destinationLength;

        if (this._framesAvailable < 0) {
          this._framesAvailable = 0;
        }
      }
    }, {
      key: "framesAvailable",
      get: function get() {
        return this._framesAvailable;
      }
    }]);

    return RingBuffer;
  }()
}["default"];

var AmplitudeProcessor =
/*#__PURE__*/
function (_AudioWorkletProcesso) {
  _inherits(AmplitudeProcessor, _AudioWorkletProcesso);

  function AmplitudeProcessor(options) {
    var _this;

    _classCallCheck(this, AmplitudeProcessor);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(AmplitudeProcessor).call(this));
    var processorOptions = options.processorOptions || {};
    _this.numOutputChannels = options.outputChannelCount || 1;
    _this.numInputChannels = processorOptions.numInputChannels || 2;
    _this.normalize = processorOptions.normalize || false;
    _this.smoothing = processorOptions.smoothing || 0;
    _this.bufferSize = processorOptions.bufferSize || 2048;
    _this.inputRingBuffer = new RingBuffer(_this.bufferSize, _this.numInputChannels);
    _this.outputRingBuffer = new RingBuffer(_this.bufferSize, _this.numOutputChannels);
    _this.inputRingBufferArraySequence = new Array(_this.numInputChannels).fill(null).map(function () {
      return new Float32Array(_this.bufferSize);
    });
    _this.stereoVol = [0, 0];
    _this.stereoVolNorm = [0, 0];
    _this.volMax = 0.001;

    _this.port.onmessage = function (event) {
      var data = event.data;

      if (data.name === 'toggleNormalize') {
        _this.normalize = data.normalize;
      } else if (data.name === 'smoothing') {
        _this.smoothing = Math.max(0, Math.min(1, data.smoothing));
      }
    };

    return _this;
  } // TO DO make this stereo / dependent on # of audio channels


  _createClass(AmplitudeProcessor, [{
    key: "process",
    value: function process(inputs, outputs) {
      var input = inputs[0];
      var output = outputs[0];
      var smoothing = this.smoothing;
      this.inputRingBuffer.push(input);

      if (this.inputRingBuffer.framesAvailable >= this.bufferSize) {
        this.inputRingBuffer.pull(this.inputRingBufferArraySequence);

        for (var channel = 0; channel < this.numInputChannels; ++channel) {
          var inputBuffer = this.inputRingBufferArraySequence[channel];
          var bufLength = inputBuffer.length;
          var sum = 0;

          for (var i = 0; i < bufLength; i++) {
            var x = inputBuffer[i];

            if (this.normalize) {
              sum += Math.max(Math.min(x / this.volMax, 1), -1) * Math.max(Math.min(x / this.volMax, 1), -1);
            } else {
              sum += x * x;
            }
          } // ... then take the square root of the sum.


          var rms = Math.sqrt(sum / bufLength);
          this.stereoVol[channel] = Math.max(rms, this.stereoVol[channel] * smoothing);
          this.volMax = Math.max(this.stereoVol[channel], this.volMax);
        } // calculate stero normalized volume and add volume from all channels together


        var volSum = 0;

        for (var index = 0; index < this.stereoVol.length; index++) {
          this.stereoVolNorm[index] = Math.max(Math.min(this.stereoVol[index] / this.volMax, 1), 0);
          volSum += this.stereoVol[index];
        } // volume is average of channels


        var volume = volSum / this.stereoVol.length; // normalized value

        var volNorm = Math.max(Math.min(volume / this.volMax, 1), 0);
        this.port.postMessage({
          name: 'amplitude',
          volume: volume,
          volNorm: volNorm,
          stereoVol: this.stereoVol,
          stereoVolNorm: this.stereoVolNorm
        }); // pass input through to output

        this.outputRingBuffer.push(this.inputRingBufferArraySequence);
      } // pull 128 frames out of the ring buffer
      // if the ring buffer does not have enough frames, the output will be silent


      this.outputRingBuffer.pull(output);
      return true;
    }
  }]);

  return AmplitudeProcessor;
}(_wrapNativeSuper(AudioWorkletProcessor));

registerProcessor(processorNames.amplitudeProcessor, AmplitudeProcessor);`},function(y,T,h){var g,f;g=[h(0),h(17)],f=(function(o){o.Frequency=function(c,l){if(!(this instanceof o.Frequency))return new o.Frequency(c,l);o.TimeBase.call(this,c,l)},o.extend(o.Frequency,o.TimeBase),o.Frequency.prototype._primaryExpressions=Object.create(o.TimeBase.prototype._primaryExpressions),o.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(c){return this.midiToFrequency(c)}},o.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(c,l){var d=r[c.toLowerCase()]+12*(parseInt(l)+1);return this.midiToFrequency(d)}},o.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(c,l,d){var _=1;return c&&c!=="0"&&(_*=this._beatsToUnits(this._timeSignature()*parseFloat(c))),l&&l!=="0"&&(_*=this._beatsToUnits(parseFloat(l))),d&&d!=="0"&&(_*=this._beatsToUnits(parseFloat(d)/4)),_}},o.Frequency.prototype.transpose=function(c){return this._expr=(function(l,d){return l()*this.intervalToFrequencyRatio(d)}).bind(this,this._expr,c),this},o.Frequency.prototype.harmonize=function(c){return this._expr=(function(l,d){for(var _=l(),w=[],S=0;S<d.length;S++)w[S]=_*this.intervalToFrequencyRatio(d[S]);return w}).bind(this,this._expr,c),this},o.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.valueOf())},o.Frequency.prototype.toNote=function(){var c=this.valueOf(),l=Math.log(c/o.Frequency.A4)/Math.LN2,d=Math.round(12*l)+57,_=Math.floor(d/12);return _<0&&(d+=-12*_),a[d%12]+_.toString()},o.Frequency.prototype.toSeconds=function(){return 1/this.valueOf()},o.Frequency.prototype.toFrequency=function(){return this.valueOf()},o.Frequency.prototype.toTicks=function(){var c=this._beatsToUnits(1),l=this.valueOf()/c;return Math.floor(l*o.Transport.PPQ)},o.Frequency.prototype._frequencyToUnits=function(c){return c},o.Frequency.prototype._ticksToUnits=function(c){return 1/(60*c/(o.Transport.bpm.value*o.Transport.PPQ))},o.Frequency.prototype._beatsToUnits=function(c){return 1/o.TimeBase.prototype._beatsToUnits.call(this,c)},o.Frequency.prototype._secondsToUnits=function(c){return 1/c},o.Frequency.prototype._defaultUnits="hz";var r={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return o.Frequency.A4=440,o.Frequency.prototype.midiToFrequency=function(c){return o.Frequency.A4*Math.pow(2,(c-69)/12)},o.Frequency.prototype.frequencyToMidi=function(c){return 69+12*Math.log(c/o.Frequency.A4)/Math.LN2},o.Frequency}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(16)],f=(function(o){return o.TransportTime=function(r,a){if(!(this instanceof o.TransportTime))return new o.TransportTime(r,a);o.Time.call(this,r,a)},o.extend(o.TransportTime,o.Time),o.TransportTime.prototype._unaryExpressions=Object.create(o.Time.prototype._unaryExpressions),o.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(r){var a=this._secondsToTicks(r()),c=Math.ceil(o.Transport.ticks/a);return this._ticksToUnits(c*a)}},o.TransportTime.prototype._secondsToTicks=function(r){var a=r/this._beatsToUnits(1);return Math.round(a*o.Transport.PPQ)},o.TransportTime.prototype.valueOf=function(){return this._secondsToTicks(this._expr())+(this._plusNow?o.Transport.ticks:0)},o.TransportTime.prototype.toTicks=function(){return this.valueOf()},o.TransportTime.prototype.toSeconds=function(){return this._expr()+(this._plusNow?o.Transport.seconds:0)},o.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},o.TransportTime}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(4),h(13),h(1),h(33),h(21),h(34),h(20),h(35),h(36),h(37)],f=(function(o){function r(d,_,w){var S=new d;return w._eval(_[0]).connect(S,0,0),w._eval(_[1]).connect(S,0,1),S}function a(d,_,w){var S=new d;return w._eval(_[0]).connect(S,0,0),S}function c(d){return d?parseFloat(d):void 0}function l(d){return d&&d.args?parseFloat(d.args):void 0}return o.Expr=function(){var d=this._replacements(Array.prototype.slice.call(arguments)),_=this._parseInputs(d);this._nodes=[],this.input=new Array(_);for(var w=0;w<_;w++)this.input[w]=this.context.createGain();var S,k=this._parseTree(d);try{S=this._eval(k)}catch{throw this._disposeNodes(),new Error("Tone.Expr: Could evaluate expression: "+d)}this.output=S},o.extend(o.Expr,o.SignalBase),o.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(d){return new o.Signal(c(d))}},input:{regexp:/^\$\d/,method:function(d,_){return _.input[c(d.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:a.bind(this,o.Abs)},mod:{regexp:/^mod/,method:function(d,_){var w=l(d[1]),S=new o.Modulo(w);return _._eval(d[0]).connect(S),S}},pow:{regexp:/^pow/,method:function(d,_){var w=l(d[1]),S=new o.Pow(w);return _._eval(d[0]).connect(S),S}},a2g:{regexp:/^a2g/,method:function(d,_){var w=new o.AudioToGain;return _._eval(d[0]).connect(w),w}}},binary:{"+":{regexp:/^\+/,precedence:1,method:r.bind(this,o.Add)},"-":{regexp:/^\-/,precedence:1,method:function(d,_){return d.length===1?a(o.Negate,d,_):r(o.Subtract,d,_)}},"*":{regexp:/^\*/,precedence:0,method:r.bind(this,o.Multiply)}},unary:{"-":{regexp:/^\-/,method:a.bind(this,o.Negate)},"!":{regexp:/^\!/,method:a.bind(this,o.NOT)}}},o.Expr.prototype._parseInputs=function(d){var _=d.match(/\$\d/g),w=0;if(_!==null)for(var S=0;S<_.length;S++){var k=parseInt(_[S].substr(1))+1;w=Math.max(w,k)}return w},o.Expr.prototype._replacements=function(d){for(var _=d.shift(),w=0;w<d.length;w++)_=_.replace(/\%/i,d[w]);return _},o.Expr.prototype._tokenize=function(d){for(var _=-1,w=[];0<d.length;){var S=k(d=d.trim());w.push(S),d=d.substr(S.value.length)}function k(A){for(var R in o.Expr._Expressions){var O=o.Expr._Expressions[R];for(var N in O){var E=O[N],M=E.regexp,D=A.match(M);if(D!==null)return{type:R,value:D[0],method:E.method}}}throw new SyntaxError("Tone.Expr: Unexpected token "+A)}return{next:function(){return w[++_]},peek:function(){return w[_+1]}}},o.Expr.prototype._parseTree=function(d){var _=this._tokenize(d),w=this.isUndef.bind(this);function S(O,N){return!w(O)&&O.type==="glue"&&O.value===N}function k(O,N,E){var M=o.Expr._Expressions[N];if(!w(O))for(var D in M){var I=M[D];if(I.regexp.test(O.value)&&(w(E)||I.precedence===E))return!0}return!1}function A(O){var N;w(O)&&(O=5),N=O<0?function M(){var D,I;return D=_.peek(),k(D,"unary")?(D=_.next(),I=M(),{operator:D.value,method:D.method,args:[I]}):R()}():A(O-1);for(var E=_.peek();k(E,"binary",O);)N={operator:(E=_.next()).value,method:E.method,args:[N,A(O-1)]},E=_.peek();return N}function R(){var O,N;if(O=_.peek(),w(O))throw new SyntaxError("Tone.Expr: Unexpected termination of expression");if(O.type==="func")return function(E){var M=[];if(!S(_.next(),"("))throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+E.value+'"');if(S(_.peek(),")")||(M=function(){for(var D,I=[];D=A(),!w(D)&&(I.push(D),S(_.peek(),","));)_.next();return I}()),S(_.next(),")"))return{method:E.method,args:M,name};throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+E.value+'"')}(O=_.next());if(O.type==="value")return{method:(O=_.next()).method,args:O.value};if(S(O,"(")){if(_.next(),N=A(),!S(O=_.next(),")"))throw new SyntaxError("Expected )");return N}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+O.value)}return A()},o.Expr.prototype._eval=function(d){if(!this.isUndef(d)){var _=d.method(d.args,this);return this._nodes.push(_),_}},o.Expr.prototype._disposeNodes=function(){for(var d=0;d<this._nodes.length;d++){var _=this._nodes[d];this.isFunction(_.dispose)?_.dispose():this.isFunction(_.disconnect)&&_.disconnect(),_=null,this._nodes[d]=null}this._nodes=null},o.Expr.prototype.dispose=function(){o.prototype.dispose.call(this),this._disposeNodes()},o.Expr}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(21),h(13),h(2)],f=(function(o){return o.GreaterThan=function(r){this.createInsOuts(2,0),this._param=this.input[0]=new o.Subtract(r),this.input[1]=this._param.input[1],this._gtz=this.output=new o.GreaterThanZero,this._param.connect(this._gtz)},o.extend(o.GreaterThan,o.Signal),o.GreaterThan.prototype.dispose=function(){return o.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},o.GreaterThan}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(6),h(15)],f=(function(o){return o.Abs=function(){this._abs=this.input=this.output=new o.WaveShaper(function(r){return r===0?0:Math.abs(r)},127)},o.extend(o.Abs,o.SignalBase),o.Abs.prototype.dispose=function(){return o.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},o.Abs}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(6),h(1),h(13)],f=(function(o){return o.Modulo=function(r){this.createInsOuts(1,0),this._shaper=new o.WaveShaper(Math.pow(2,16)),this._multiply=new o.Multiply,this._subtract=this.output=new o.Subtract,this._modSignal=new o.Signal(r),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(r)},o.extend(o.Modulo,o.SignalBase),o.Modulo.prototype._setWaveShaper=function(r){this._shaper.setMap(function(a){return Math.floor((a+1e-4)/r)})},Object.defineProperty(o.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(r){this._modSignal.value=r,this._setWaveShaper(r)}}),o.Modulo.prototype.dispose=function(){return o.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},o.Modulo}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(6)],f=(function(o){return o.Pow=function(r){this._exp=this.defaultArg(r,1),this._expScaler=this.input=this.output=new o.WaveShaper(this._expFunc(this._exp),8192)},o.extend(o.Pow,o.SignalBase),Object.defineProperty(o.Pow.prototype,"value",{get:function(){return this._exp},set:function(r){this._exp=r,this._expScaler.setMap(this._expFunc(this._exp))}}),o.Pow.prototype._expFunc=function(r){return function(a){return Math.pow(Math.abs(a),r)}},o.Pow.prototype.dispose=function(){return o.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},o.Pow}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(6),h(2)],f=(function(o){return o.AudioToGain=function(){this._norm=this.input=this.output=new o.WaveShaper(function(r){return(r+1)/2})},o.extend(o.AudioToGain,o.SignalBase),o.AudioToGain.prototype.dispose=function(){return o.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},o.AudioToGain}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(6)],f=(function(o){return o.EqualPowerGain=function(){this._eqPower=this.input=this.output=new o.WaveShaper((function(r){return Math.abs(r)<.001?0:this.equalPowerScale(r)}).bind(this),4096)},o.extend(o.EqualPowerGain,o.SignalBase),o.EqualPowerGain.prototype.dispose=function(){return o.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},o.EqualPowerGain}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){var g,f;g=[h(0),h(19),h(9)],f=(function(o){return o.TimelineState=function(r){o.Timeline.call(this),this._initial=r},o.extend(o.TimelineState,o.Timeline),o.TimelineState.prototype.getValueAtTime=function(r){var a=this.get(r);return a!==null?a.state:this._initial},o.TimelineState.prototype.setStateAtTime=function(r,a){this.add({state:r,time:a})},o.TimelineState}).apply(T,g),f!==void 0&&(y.exports=f)},function(y,T,h){h.r(T),h(24),h(25);var g=h(3);function f(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function i(){f(this,i),this.input=g.a.createGain(),this.output=g.a.createGain(),this.limiter=g.a.createDynamicsCompressor(),this.limiter.threshold.value=-3,this.limiter.ratio.value=20,this.limiter.knee.value=1,this.audiocontext=g.a,this.output.disconnect(),this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=g.a.createGain(),this.fftMeter=g.a.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]},r=new o;p5.prototype.getOutputVolume=function(){return r.output.gain.value},p5.prototype.outputVolume=function(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(typeof i=="number"){var n=r.audiocontext.currentTime,s=r.output.gain.value;r.output.gain.cancelScheduledValues(n+t),r.output.gain.linearRampToValueAtTime(s,n+t),r.output.gain.linearRampToValueAtTime(i,n+t+e)}else if(i)i.connect(r.output.gain);else return r.output.gain},p5.prototype.soundOut=p5.soundOut=r,p5.soundOut._silentNode=r.audiocontext.createGain(),p5.soundOut._silentNode.gain.value=0,p5.soundOut._silentNode.connect(r.audiocontext.destination);var a=r,c=h(5),l=h.n(c);function d(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?d=function(t){return typeof t}:d=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(i)}function _(){return a.audiocontext.sampleRate}function w(i){var e=Math.log(i/440)/Math.log(2),t=Math.round(12*e)+69;return t}function S(i){return 440*Math.pow(2,(i-69)/12)}function k(i){if(typeof i!="string")return i;var e={A:21,B:23,C:24,D:26,E:28,F:29,G:31},t=e[i[0].toUpperCase()],n=~~i.slice(-1);switch(t+=12*(n-1),i[1]){case"#":t+=1;break;case"b":t-=1;break}return S(t)}function A(){a.extensions=[];for(var i=0;i<arguments.length;i++)if(arguments[i]=arguments[i].toLowerCase(),["mp3","wav","ogg","m4a","aac"].indexOf(arguments[i])>-1)a.extensions.push(arguments[i]);else throw arguments[i]+" is not a valid sound format!"}function R(){for(var i=0;i<a.soundArray.length;i++)a.soundArray[i].dispose()}function O(i){var e;if(typeof i=="string"){e=i;var t=e.split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(t)>-1){if(!p5.prototype.isFileSupported(t))for(var n=e.split("."),s=n[n.length-1],u=0;u<a.extensions.length;u++){var m=a.extensions[u],v=p5.prototype.isFileSupported(m);if(v){s="",n.length===2&&(s+=n[0]);for(var b=1;b<=n.length-2;b++){var P=n[b];s+="."+P}e=s+=".",e=e+=m;break}}}else for(var x=0;x<a.extensions.length;x++){var C=a.extensions[x],V=p5.prototype.isFileSupported(C);if(V){e=e+"."+C;break}}}else if(d(i)==="object")for(var B=0;B<i.length;B++){var q=i[B].split(".").pop(),j=p5.prototype.isFileSupported(q);if(j){e=i[B];break}}return e}function N(i,e,t,n,s){for(var u in i.mathOps)i.mathOps[u]instanceof s&&(i.mathOps[u].dispose(),t=u,t<i.mathOps.length-1&&(n=i.mathOps[u+1]));return i.mathOps[t-1].disconnect(),i.mathOps[t-1].connect(e),e.connect(n),i.mathOps[t]=e,i}function E(i){var e,t;e=i.getChannelData(0),i.numberOfChannels>1?t=i.getChannelData(1):t=e;var n=M(e,t),s=new window.ArrayBuffer(44+n.length*2),u=new window.DataView(s);D(u,0,"RIFF"),u.setUint32(4,36+n.length*2,!0),D(u,8,"WAVE"),D(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,2,!0),u.setUint32(24,a.audiocontext.sampleRate,!0),u.setUint32(28,a.audiocontext.sampleRate*4,!0),u.setUint16(32,4,!0),u.setUint16(34,16,!0),D(u,36,"data"),u.setUint32(40,n.length*2,!0);for(var m=n.length,v=44,b=1,P=0;P<m;P++)u.setInt16(v,n[P]*(32767*b),!0),v+=2;return u}function M(i,e){for(var t=i.length+e.length,n=new Float32Array(t),s=0,u=0;u<t;)n[u++]=i[s],n[u++]=e[s],s++;return n}function D(i,e,t){for(var n=t.length,s=0;s<n;s++)i.setUint8(e+s,t.charCodeAt(s))}function I(i){var e=i,t=new AudioWorkletNode(a.audiocontext,l.a.soundFileProcessor);return t instanceof ScriptProcessorNode&&(e=t.bufferSize),t.disconnect(),t=null,e}function je(i,e){var t=E(i.buffer);p5.prototype.writeFile([t],e,"wav")}var We=function(e,t,n){var s=new Error,u,m;return s.name=e,s.originalStack=s.stack+t,u=s.stack+t,s.failedPath=n,m=u.split(`
`).filter(function(v){return!v.match(/(p5.|native code|globalInit)/g)}),s.stack=m.join(`
`),s},K=We,Ge=[h(27).default,h(28).default,h(29).default],Ye=a.audiocontext,fe=!1;function ze(){return Promise.all(Ge.map(function(i){var e=new Blob([i],{type:"application/javascript"}),t=URL.createObjectURL(e);return Ye.audioWorklet.addModule(t)}))}p5.prototype.registerMethod("init",function(){if(!fe){!this.preload&&!window.preload&&(this.preload=function(){}),this._incrementPreload();var i=(function(){fe=!0,this._decrementPreload()}).bind(this);ze().then(i)}});function he(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Ke(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function pe(i,e,t){return e&&Ke(i.prototype,e),i}var L=a.audiocontext,Lt;if(typeof L.createStereoPanner<"u"){var Ze=function(){function i(e,t){he(this,i),this.stereoPanner=this.input=L.createStereoPanner(),e.connect(this.stereoPanner),this.stereoPanner.connect(t)}return pe(i,[{key:"pan",value:function(t,n){var s=n||0,u=L.currentTime+s;this.stereoPanner.pan.linearRampToValueAtTime(t,u)}},{key:"inputChannels",value:function(){}},{key:"connect",value:function(t){this.stereoPanner.connect(t)}},{key:"disconnect",value:function(){this.stereoPanner&&this.stereoPanner.disconnect()}}]),i}();Lt=Ze}else{var Xe=function(){function i(e,t,n){he(this,i),this.input=L.createGain(),e.connect(this.input),this.left=L.createGain(),this.right=L.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",n>1?(this.splitter=L.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=L.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(t)}return pe(i,[{key:"pan",value:function(t,n){var s=n||0,u=L.currentTime+s,m=(t+1)/2,v=Math.cos(m*Math.PI/2),b=Math.sin(m*Math.PI/2);this.left.gain.linearRampToValueAtTime(b,u),this.right.gain.linearRampToValueAtTime(v,u)}},{key:"inputChannels",value:function(t){t===1?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):t===2&&(typeof this.splitter>"u"&&(this.splitter=L.createChannelSplitter(2)),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))}},{key:"connect",value:function(t){this.output.connect(t)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}}]),i}();Lt=Xe}var jt=Lt;function st(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?st=function(t){return typeof t}:st=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},st(i)}function Qe(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function He(i,e,t){return e&&Qe(i.prototype,e),i}function de(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var U=a.audiocontext,$e=function(e){for(var t=e.length,n=U.createBuffer(1,e.length,U.sampleRate),s=n.getChannelData(0),u=0;u<t;u++)s[u]=u;return n},Je=function i(e,t,n,s){de(this,i),this.callback=e,this.time=t,this.id=n,this.val=s};function tn(i){var e=i.target,t=this;e._playing=!1,e.removeEventListener("ended",t._clearOnEnd),t._onended(t),t.bufferSourceNodes.map(function(n,s){return s}).reverse().forEach(function(n){var s=t.bufferSourceNodes[n];s._playing===!1&&t.bufferSourceNodes.splice(n,1)}),t.bufferSourceNodes.length===0&&(t._playing=!1)}var me=function(){function i(e,t,n,s){if(de(this,i),typeof e<"u"){if(typeof e=="string"||typeof e[0]=="string"){var u=p5.prototype._checkFileFormats(e);this.url=u}else if(st(e)==="object"&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";e.file&&(e=e.file),this.file=e}this._onended=function(){},this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._cueIDCounter=0,this._lastPos=0,this._counterNode=null,this._workletNode=null,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.input=a.audiocontext.createGain(),this.output=a.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.panPosition=0,this.panner=new jt(this.output,a.input,2),(this.url||this.file)&&this.load(t,n),a.soundArray.push(this),typeof s=="function"?this._whileLoading=s:this._whileLoading=function(){},this._clearOnEnd=tn.bind(this),this.amp=this.setVolume,this.fade=this.setVolume}return He(i,[{key:"load",value:function(t,n){var s=this,u=new Error().stack;if(this.url!==void 0&&this.url!==""){var m=new XMLHttpRequest;m.addEventListener("progress",function(b){s._updateProgress(b)},!1),m.open("GET",this.url,!0),m.responseType="arraybuffer",m.onload=function(){if(m.status===200){if(!s.panner)return;U.decodeAudioData(m.response,function(x){s.panner&&(s.buffer=x,s.panner.inputChannels(x.numberOfChannels),t&&t(s))},function(){if(s.panner){var x=new K("decodeAudioData",u,s.url),C="AudioContext error at decodeAudioData for "+s.url;n?(x.msg=C,n(x)):console.error(C+`
 The error stack trace includes: 
`+x.stack)}})}else{if(!s.panner)return;var b=new K("loadSound",u,s.url),P="Unable to load "+s.url+". The request status was: "+m.status+" ("+m.statusText+")";n?(b.message=P,n(b)):console.error(P+`
 The error stack trace includes: 
`+b.stack)}},m.onerror=function(){var b=new K("loadSound",u,s.url),P="There was no response from the server at "+s.url+". Check the url and internet connectivity.";n?(b.message=P,n(b)):console.error(P+`
 The error stack trace includes: 
`+b.stack)},m.send()}else if(this.file!==void 0){var v=new FileReader;v.onload=function(){s.panner&&U.decodeAudioData(v.result,function(b){s.panner&&(s.buffer=b,s.panner.inputChannels(b.numberOfChannels),t&&t(s))})},v.onerror=function(b){s.panner&&onerror&&onerror(b)},v.readAsArrayBuffer(this.file)}}},{key:"_updateProgress",value:function(t){if(t.lengthComputable){var n=t.loaded/t.total*.99;this._whileLoading(n,t)}else this._whileLoading("size unknown")}},{key:"isLoaded",value:function(){return!!this.buffer}},{key:"play",value:function(t,n,s,u,m){if(!this.output){console.warn("SoundFile.play() called after dispose");return}var v=a.audiocontext.currentTime,b,P,x=t||0;if(x<0&&(x=0),x=x+v,typeof n<"u"&&this.rate(n),typeof s<"u"&&this.setVolume(s),this.buffer){if(this._pauseTime=0,this.mode==="restart"&&this.buffer&&this.bufferSourceNode&&(this.bufferSourceNode.stop(x),this._counterNode.stop(x)),this.mode==="untildone"&&this.isPlaying())return;if(this.bufferSourceNode=this._initSourceNode(),delete this._counterNode,this._counterNode=this._initCounterNode(),u)if(u>=0&&u<this.buffer.duration)b=u;else throw"start time out of range";else b=0;m&&(m=m<=this.buffer.duration-b?m:this.buffer.duration),this._paused?(this.bufferSourceNode.start(x,this.pauseTime,m),this._counterNode.start(x,this.pauseTime,m)):(this.bufferSourceNode.start(x,b,m),this._counterNode.start(x,b,m)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1,this.bufferSourceNode.addEventListener("ended",this._clearOnEnd)}else throw"not ready to play file, buffer has yet to load. Try preload()";this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping,this._looping===!0&&(P=m||b-1e-15,this.bufferSourceNode.loopStart=b,this.bufferSourceNode.loopEnd=P,this._counterNode.loopStart=b,this._counterNode.loopEnd=P)}},{key:"playMode",value:function(t){var n=t.toLowerCase();if(n==="restart"&&this.buffer&&this.bufferSourceNode)for(var s=0;s<this.bufferSourceNodes.length-1;s++){var u=a.audiocontext.currentTime;this.bufferSourceNodes[s].stop(u)}if(n==="restart"||n==="sustain"||n==="untildone")this.mode=n;else throw'Invalid play mode. Must be either "restart" or "sustain"'}},{key:"pause",value:function(t){var n=a.audiocontext.currentTime,s=t||0,u=s+n;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this._paused=!0,this._playing=!1,this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(u),this._counterNode.stop(u),this._pauseTime=this.currentTime()):this._pauseTime=0}},{key:"loop",value:function(t,n,s,u,m){this._looping=!0,this.play(t,n,s,u,m)}},{key:"setLoop",value:function(t){if(t===!0)this._looping=!0;else if(t===!1)this._looping=!1;else throw"Error: setLoop accepts either true or false";this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)}},{key:"isLooping",value:function(){return this.bufferSourceNode?this._looping===!0&&this.isPlaying()===!0:!1}},{key:"isPlaying",value:function(){return this._playing}},{key:"isPaused",value:function(){return this._paused}},{key:"stop",value:function(t){var n=t||0;if(this.mode==="sustain"||this.mode==="untildone")this.stopAll(n),this._playing=!1,this.pauseTime=0,this._paused=!1;else if(this.buffer&&this.bufferSourceNode){var s=a.audiocontext.currentTime,u=n||0;this.pauseTime=0,this.bufferSourceNode.stop(s+u),this._counterNode.stop(s+u),this._playing=!1,this._paused=!1}}},{key:"stopAll",value:function(t){var n=a.audiocontext.currentTime,s=t||0;if(this.buffer&&this.bufferSourceNode){for(var u in this.bufferSourceNodes){var m=this.bufferSourceNodes[u];if(m)try{m.stop(n+s)}catch{}}this._counterNode.stop(n+s)}}},{key:"getVolume",value:function(){return this.output.gain.value}},{key:"pan",value:function(t,n){this.panPosition=t,this.panner.pan(t,n)}},{key:"getPan",value:function(){return this.panPosition}},{key:"rate",value:function(t){var n=!1;if(typeof t>"u")return this.playbackRate;if(this.playbackRate=t,t===0?t=1e-13:t<0&&!this.reversed?(t=Math.abs(t),n=!0):t>0&&this.reversed&&(n=!0),this.bufferSourceNode){var s=a.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(s),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(t),s),this._counterNode.playbackRate.cancelScheduledValues(s),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(t),s)}return n&&this.reverseBuffer(),this.playbackRate}},{key:"setPitch",value:function(t){var n=S(t)/S(60);this.rate(n)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setVolume",value:function(t,n,s){if(typeof t=="number"){var u=n||0,m=s||0,v=a.audiocontext.currentTime,b=this.output.gain.value;this.output.gain.cancelScheduledValues(v+m),this.output.gain.linearRampToValueAtTime(b,v+m),this.output.gain.linearRampToValueAtTime(t,v+m+u)}else if(t)t.connect(this.output.gain);else return this.output.gain}},{key:"duration",value:function(){return this.buffer?this.buffer.duration:0}},{key:"currentTime",value:function(){return this.reversed?Math.abs(this._lastPos-this.buffer.length)/U.sampleRate:this._lastPos/U.sampleRate}},{key:"jump",value:function(t,n){if(t<0||t>this.buffer.duration)throw"jump time out of range";if(n>this.buffer.duration-t)throw"end time out of range";var s=t||0,u=n||void 0;this.isPlaying()&&(this.stop(0),this.play(0,this.playbackRate,this.output.gain.value,s,u))}},{key:"channels",value:function(){return this.buffer.numberOfChannels}},{key:"sampleRate",value:function(){return this.buffer.sampleRate}},{key:"frames",value:function(){return this.buffer.length}},{key:"getPeaks",value:function(t){if(this.buffer){if(t||(t=window.width*5),this.buffer){for(var n=this.buffer,s=n.length/t,u=~~(s/10)||1,m=n.numberOfChannels,v=new Float32Array(Math.round(t)),b=0;b<m;b++)for(var P=n.getChannelData(b),x=0;x<t;x++){for(var C=~~(x*s),V=~~(C+s),B=0,q=C;q<V;q+=u){var j=P[q];(j>B||-j>B)&&(B=j)}(b===0||Math.abs(B)>v[x])&&(v[x]=B)}return v}}else throw"Cannot load peaks yet, buffer is not loaded"}},{key:"reverseBuffer",value:function(){if(this.buffer){var t=this._lastPos/U.sampleRate,n=this.getVolume();this.setVolume(0,.001);for(var s=this.buffer.numberOfChannels,u=0;u<s;u++)this.buffer.getChannelData(u).reverse();this.reversed=!this.reversed,this.isPlaying()&&t&&this.jump(this.duration()-t),this.setVolume(n,.001)}else throw"SoundFile is not done loading"}},{key:"onended",value:function(t){return this._onended=t,this}},{key:"add",value:function(){}},{key:"dispose",value:function(){var t=a.audiocontext.currentTime,n=a.soundArray.indexOf(this);if(a.soundArray.splice(n,1),this.stop(t),this.buffer&&this.bufferSourceNode){for(var s=0;s<this.bufferSourceNodes.length-1;s++)if(this.bufferSourceNodes[s]!==null){this.bufferSourceNodes[s].disconnect();try{this.bufferSourceNodes[s].stop(t)}catch{console.warn("no buffer source node to dispose")}this.bufferSourceNodes[s]=null}if(this.isPlaying()){try{this._counterNode.stop(t)}catch(u){console.log(u)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)}},{key:"connect",value:function(t){t?t.hasOwnProperty("input")?this.panner.connect(t.input):this.panner.connect(t):this.panner.connect(a.input)}},{key:"disconnect",value:function(){this.panner&&this.panner.disconnect()}},{key:"getLevel",value:function(){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")}},{key:"setPath",value:function(t,n){var s=p5.prototype._checkFileFormats(t);this.url=s,this.load(n)}},{key:"setBuffer",value:function(t){var n=t.length,s=t[0].length,u=U.createBuffer(n,s,U.sampleRate);t[0]instanceof Float32Array||(t[0]=new Float32Array(t[0]));for(var m=0;m<n;m++){var v=u.getChannelData(m);v.set(t[m])}this.buffer=u,this.panner.inputChannels(n)}},{key:"_initCounterNode",value:function(){var t=this,n=this,s=U.currentTime,u=U.createBufferSource(),m=I(256);return n._workletNode&&(n._workletNode.disconnect(),delete n._workletNode),n._workletNode=new AudioWorkletNode(U,l.a.soundFileProcessor,{processorOptions:{bufferSize:m}}),n._workletNode.port.onmessage=function(v){if(v.data.name==="position"){if(v.data.position===0)return;t._lastPos=v.data.position,t._onTimeUpdate(n._lastPos)}},u.buffer=$e(n.buffer),u.playbackRate.setValueAtTime(n.playbackRate,s),u.connect(n._workletNode),n._workletNode.connect(p5.soundOut._silentNode),u}},{key:"_initSourceNode",value:function(){var t=U.createBufferSource();return t.buffer=this.buffer,t.playbackRate.value=this.playbackRate,t.connect(this.output),t}},{key:"processPeaks",value:function(t,n,s,u){console.warn("processPeaks is deprecated")}},{key:"addCue",value:function(t,n,s){var u=this._cueIDCounter++,m=new Je(n,t,u,s);return this._cues.push(m),u}},{key:"removeCue",value:function(t){for(var n=this._cues.length,s=0;s<n;s++){var u=this._cues[s];if(u.id===t){this._cues.splice(s,1);break}}this._cues.length}},{key:"clearCues",value:function(){this._cues=[]}},{key:"_onTimeUpdate",value:function(t){for(var n=t/this.buffer.sampleRate,s=this._cues.length,u=0;u<s;u++){var m=this._cues[u],v=m.time,b=m.val,P=this._prevUpdateTime||0,x=n;P<=v&&v<=x&&m.callback(b)}this._prevUpdateTime=n}},{key:"save",value:function(t){p5.prototype.saveSound(this,t,"wav")}},{key:"getBlob",value:function(){var t=E(this.buffer);return new Blob([t],{type:"audio/wav"})}}]),i}();function en(i,e,t,n){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&window.alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var s=this,u=new me(i,function(){typeof e=="function"&&e.apply(s,arguments),typeof s._decrementPreload=="function"&&s._decrementPreload()},t,n);return u}var nn=me;function rn(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function on(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function sn(i,e,t){return e&&on(i.prototype,e),i}var an=function(){function i(e){rn(this,i),this.bufferSize=I(2048),this.audiocontext=a.audiocontext,this._workletNode=new AudioWorkletNode(this.audiocontext,l.a.amplitudeProcessor,{outputChannelCount:[1],parameterData:{smoothing:e||0},processorOptions:{normalize:!1,smoothing:e||0,numInputChannels:2,bufferSize:this.bufferSize}}),this._workletNode.port.onmessage=(function(t){t.data.name==="amplitude"&&(this.volume=t.data.volume,this.volNorm=t.data.volNorm,this.stereoVol=t.data.stereoVol,this.stereoVolNorm=t.data.stereoVolNorm)}).bind(this),this.input=this._workletNode,this.output=this.audiocontext.createGain(),this.volume=0,this.volNorm=0,this.stereoVol=[0,0],this.stereoVolNorm=[0,0],this.normalize=!1,this._workletNode.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),a.meter.connect(this._workletNode),a.soundArray.push(this)}return sn(i,[{key:"setInput",value:function(t,n){a.meter.disconnect(),n&&(this._workletNode.parameters.get("smoothing").value=n),t==null?(console.log("Amplitude input source is not ready! Connecting to main output instead"),a.meter.connect(this._workletNode)):t?(t.connect(this._workletNode),this._workletNode.disconnect(),this._workletNode.connect(this.output)):a.meter.connect(this._workletNode)}},{key:"connect",value:function(t){t?t.hasOwnProperty("input")?this.output.connect(t.input):this.output.connect(t):this.output.connect(this.panner.connect(a.input))}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"getLevel",value:function(t){return typeof t<"u"?this.normalize?this.stereoVolNorm[t]:this.stereoVol[t]:this.normalize?this.volNorm:this.volume}},{key:"toggleNormalize",value:function(t){typeof t=="boolean"?this.normalize=t:this.normalize=!this.normalize,this._workletNode.port.postMessage({name:"toggleNormalize",normalize:this.normalize})}},{key:"smooth",value:function(t){t>=0&&t<1?this._workletNode.port.postMessage({name:"smoothing",smoothing:t}):console.log("Error: smoothing must be between 0 and 1")}},{key:"dispose",value:function(){var t=a.soundArray.indexOf(this);a.soundArray.splice(t,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),this._workletNode.disconnect(),delete this._workletNode}}]),i}(),ye=an;function un(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function cn(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function ln(i,e,t){return e&&cn(i.prototype,e),i}var fn=function(){function i(e,t){un(this,i),this.input=this.analyser=a.audiocontext.createAnalyser(),Object.defineProperties(this,{bins:{get:function(){return this.analyser.fftSize/2},set:function(s){this.analyser.fftSize=s*2},configurable:!0,enumerable:!0},smoothing:{get:function(){return this.analyser.smoothingTimeConstant},set:function(s){this.analyser.smoothingTimeConstant=s},configurable:!0,enumerable:!0}}),this.smooth(e),this.bins=t||1024,a.fftMeter.connect(this.analyser),this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3],a.soundArray.push(this)}return ln(i,[{key:"setInput",value:function(t){t?(t.output?t.output.connect(this.analyser):t.connect&&t.connect(this.analyser),a.fftMeter.disconnect()):a.fftMeter.connect(this.analyser)}},{key:"waveform",value:function(){for(var t,n,s=new Array,u=0;u<arguments.length;u++)typeof arguments[u]=="number"&&(t=arguments[u],this.analyser.fftSize=t*2),typeof arguments[u]=="string"&&(n=arguments[u]);if(n&&!p5.prototype._isSafari())return dn(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;mn(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain);for(var m=0;m<this.timeDomain.length;m++){var v=p5.prototype.map(this.timeDomain[m],0,255,-1,1);s.push(v)}return s}},{key:"analyze",value:function(){for(var t,n=0;n<arguments.length;n++)typeof arguments[n]=="number"&&(this.bins=arguments[n],this.analyser.fftSize=this.bins*2),typeof arguments[n]=="string"&&(t=arguments[n]);if(t&&t.toLowerCase()==="db")return hn(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain;pn(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain);var s=Array.apply([],this.freqDomain);return s}},{key:"getEnergy",value:function(t,n){var s=a.audiocontext.sampleRate/2;if(t==="bass"?(t=this.bass[0],n=this.bass[1]):t==="lowMid"?(t=this.lowMid[0],n=this.lowMid[1]):t==="mid"?(t=this.mid[0],n=this.mid[1]):t==="highMid"?(t=this.highMid[0],n=this.highMid[1]):t==="treble"&&(t=this.treble[0],n=this.treble[1]),typeof t!="number")throw"invalid input for getEnergy()";if(n)if(t&&n){if(t>n){var m=n;n=t,t=m}for(var v=Math.round(t/s*this.freqDomain.length),b=Math.round(n/s*this.freqDomain.length),P=0,x=0,C=v;C<=b;C++)P+=this.freqDomain[C],x+=1;var V=P/x;return V}else throw"invalid input for getEnergy()";else{var u=Math.round(t/s*this.freqDomain.length);return this.freqDomain[u]}}},{key:"getFreq",value:function(t,n){console.log("getFreq() is deprecated. Please use getEnergy() instead.");var s=this.getEnergy(t,n);return s}},{key:"getCentroid",value:function(){for(var t=a.audiocontext.sampleRate/2,n=0,s=0,u=0;u<this.freqDomain.length;u++)n+=u*this.freqDomain[u],s+=this.freqDomain[u];var m=0;s!==0&&(m=n/s);var v=m*(t/this.freqDomain.length);return v}},{key:"smooth",value:function(t){return typeof t<"u"&&(this.smoothing=t),this.smoothing}},{key:"dispose",value:function(){var t=a.soundArray.indexOf(this);a.soundArray.splice(t,1),this.analyser&&(this.analyser.disconnect(),delete this.analyser)}},{key:"linAverages",value:function(t){for(var n=t||16,s=this.freqDomain,u=s.length,m=Math.floor(u/n),v=new Array(n),b=0,P=0;P<u;P++)v[b]=v[b]!==void 0?(v[b]+s[P])/2:s[P],P%m===m-1&&b++;return v}},{key:"logAverages",value:function(t){for(var n=a.audiocontext.sampleRate/2,s=this.freqDomain,u=s.length,m=new Array(t.length),v=0,b=0;b<u;b++){var P=Math.round(b*n/this.freqDomain.length);P>t[v].hi&&v++,m[v]=m[v]!==void 0?(m[v]+s[b])/2:s[b]}return m}},{key:"getOctaveBands",value:function(t,n){var s=t||3,u=n||15.625,m=[],v={lo:u/Math.pow(2,1/(2*s)),ctr:u,hi:u*Math.pow(2,1/(2*s))};m.push(v);for(var b=a.audiocontext.sampleRate/2;v.hi<b;){var P={};P.lo=v.hi,P.ctr=v.ctr*Math.pow(2,1/s),P.hi=P.ctr*Math.pow(2,1/(2*s)),m.push(P),v=P}return m}}]),i}();function hn(i){i.freqDomain instanceof Float32Array||(i.freqDomain=new Float32Array(i.analyser.frequencyBinCount))}function pn(i){i.freqDomain instanceof Uint8Array||(i.freqDomain=new Uint8Array(i.analyser.frequencyBinCount))}function dn(i){i.timeDomain instanceof Float32Array||(i.timeDomain=new Float32Array(i.analyser.frequencyBinCount))}function mn(i){i.timeDomain instanceof Uint8Array||(i.timeDomain=new Uint8Array(i.analyser.frequencyBinCount))}var yn=fn,vn=h(4),at=h.n(vn),_n=h(1),Z=h.n(_n),gn=h(8),ut=h.n(gn);function ct(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ct=function(t){return typeof t}:ct=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct(i)}function lt(i,e){return e&&(ct(e)==="object"||typeof e=="function")?e:bn(i)}function bn(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function X(i){return X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},X(i)}function ft(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&Wt(i,e)}function Wt(i,e){return Wt=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},Wt(i,e)}function Q(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Tn(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function wn(i,e,t){return e&&Tn(i.prototype,e),i}function Gt(i,e,t,n,s){var u=i.oscillator;for(var m in i.mathOps)i.mathOps[m]instanceof s&&(u.disconnect(),i.mathOps[m].dispose(),t=m,t<i.mathOps.length-2&&(n=i.mathOps[m+1]));return t===i.mathOps.length-1&&i.mathOps.push(n),m>0&&(u=i.mathOps[m-1]),u.disconnect(),u.connect(e),e.connect(n),i.mathOps[t]=e,i}var H=function(){function i(e,t){if(Q(this,i),typeof e=="string"){var n=t;t=e,e=n}if(typeof t=="number"){var s=t;t=e,e=s}this.started=!1,this.phaseAmount=void 0,this.oscillator=a.audiocontext.createOscillator(),this.f=e||440,this.oscillator.type=t||"sine",this.oscillator.frequency.setValueAtTime(this.f,a.audiocontext.currentTime),this.output=a.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=.5,this.output.gain.setValueAtTime(.5,a.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=a.input,this.panner=new jt(this.output,this.connection,1),this.mathOps=[this.output],a.soundArray.push(this),this.fade=this.amp}return wn(i,[{key:"start",value:function(t,n){if(this.started){var s=a.audiocontext.currentTime;this.stop(s)}if(!this.started){var u=n||this.f,m=this.oscillator.type;this.oscillator&&(this.oscillator.disconnect(),delete this.oscillator),this.oscillator=a.audiocontext.createOscillator(),this.oscillator.frequency.value=Math.abs(u),this.oscillator.type=m,this.oscillator.connect(this.output),t=t||0,this.oscillator.start(t+a.audiocontext.currentTime),this.freqNode=this.oscillator.frequency;for(var v in this._freqMods)typeof this._freqMods[v].connect<"u"&&this._freqMods[v].connect(this.oscillator.frequency);this.started=!0}}},{key:"stop",value:function(t){if(this.started){var n=t||0,s=a.audiocontext.currentTime;this.oscillator.stop(n+s),this.started=!1}}},{key:"amp",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(typeof t=="number"){var u=a.audiocontext.currentTime;this.output.gain.linearRampToValueAtTime(t,u+s+n)}else if(t)t.connect(this.output.gain);else return this.output.gain}},{key:"getAmp",value:function(){return this.output.gain.value}},{key:"freq",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(typeof t=="number"&&!isNaN(t)){this.f=t;var u=a.audiocontext.currentTime;n===0?this.oscillator.frequency.setValueAtTime(t,s+u):t>0?this.oscillator.frequency.exponentialRampToValueAtTime(t,s+n+u):this.oscillator.frequency.linearRampToValueAtTime(t,s+n+u),this.phaseAmount&&this.phase(this.phaseAmount)}else if(t)t.output&&(t=t.output),t.connect(this.oscillator.frequency),this._freqMods.push(t);else return this.oscillator.frequency}},{key:"getFreq",value:function(){return this.oscillator.frequency.value}},{key:"setType",value:function(t){this.oscillator.type=t}},{key:"getType",value:function(){return this.oscillator.type}},{key:"connect",value:function(t){t?t.hasOwnProperty("input")?(this.panner.connect(t.input),this.connection=t.input):(this.panner.connect(t),this.connection=t):this.panner.connect(a.input)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect(),this.panner&&(this.panner.disconnect(),this.output&&this.output.connect(this.panner)),this.oscMods=[]}},{key:"pan",value:function(t,n){this.panPosition=t,this.panner.pan(t,n)}},{key:"getPan",value:function(){return this.panPosition}},{key:"dispose",value:function(){var t=a.soundArray.indexOf(this);if(a.soundArray.splice(t,1),this.oscillator){var n=a.audiocontext.currentTime;this.stop(n),this.disconnect(),this.panner=null,this.oscillator=null}this.osc2&&this.osc2.dispose()}},{key:"phase",value:function(t){var n=p5.prototype.map(t,0,1,0,1/this.f),s=a.audiocontext.currentTime;this.phaseAmount=t,this.dNode||(this.dNode=a.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output)),this.dNode.delayTime.setValueAtTime(n,s)}},{key:"add",value:function(t){var n=new at.a(t),s=this.mathOps.length-1,u=this.output;return Gt(this,n,s,u,at.a)}},{key:"mult",value:function(t){var n=new Z.a(t),s=this.mathOps.length-1,u=this.output;return Gt(this,n,s,u,Z.a)}},{key:"scale",value:function(t,n,s,u){var m,v;arguments.length===4?(m=p5.prototype.map(s,t,n,0,1)-.5,v=p5.prototype.map(u,t,n,0,1)-.5):(m=arguments[0],v=arguments[1]);var b=new ut.a(m,v),P=this.mathOps.length-1,x=this.output;return Gt(this,b,P,x,ut.a)}}]),i}(),Sn=function(i){ft(e,i);function e(t){return Q(this,e),lt(this,X(e).call(this,t,"sine"))}return e}(H),An=function(i){ft(e,i);function e(t){return Q(this,e),lt(this,X(e).call(this,t,"triangle"))}return e}(H),ve=function(i){ft(e,i);function e(t){return Q(this,e),lt(this,X(e).call(this,t,"sawtooth"))}return e}(H),Pn=function(i){ft(e,i);function e(t){return Q(this,e),lt(this,X(e).call(this,t,"square"))}return e}(H),ht=H,xn=h(7),Yt=h.n(xn);p5.Envelope=function(i,e,t,n,s,u){this.aTime=i||.1,this.aLevel=e||1,this.dTime=t||.5,this.dLevel=n||0,this.rTime=s||0,this.rLevel=u||0,this._rampHighPercentage=.98,this._rampLowPercentage=.02,this.output=a.audiocontext.createGain(),this.control=new Yt.a,this._init(),this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],this.isExponential=!1,this.sourceToClear=null,this.wasTriggered=!1,a.soundArray.push(this)},p5.Envelope.prototype._init=function(){var i=a.audiocontext.currentTime,e=i;this.control.setTargetAtTime(1e-5,e,.001),this._setRampAD(this.aTime,this.dTime)},p5.Envelope.prototype.set=function(i,e,t,n,s,u){this.aTime=i,this.aLevel=e,this.dTime=t||0,this.dLevel=n||0,this.rTime=s||0,this.rLevel=u||0,this._setRampAD(i,t)},p5.Envelope.prototype.setADSR=function(i,e,t,n){this.aTime=i,this.dTime=e||0,this.sPercent=t||0,this.dLevel=typeof t<"u"?t*(this.aLevel-this.rLevel)+this.rLevel:0,this.rTime=n||0,this._setRampAD(i,e)},p5.Envelope.prototype.setRange=function(i,e){this.aLevel=i||1,this.rLevel=e||0},p5.Envelope.prototype._setRampAD=function(i,e){this._rampAttackTime=this.checkExpInput(i),this._rampDecayTime=this.checkExpInput(e);var t=1;t=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=i/this.checkExpInput(t),t=Math.log(1/this._rampLowPercentage),this._rampDecayTC=e/this.checkExpInput(t)},p5.Envelope.prototype.setRampPercentages=function(i,e){this._rampHighPercentage=this.checkExpInput(i),this._rampLowPercentage=this.checkExpInput(e);var t=1;t=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=this._rampAttackTime/this.checkExpInput(t),t=Math.log(1/this._rampLowPercentage),this._rampDecayTC=this._rampDecayTime/this.checkExpInput(t)},p5.Envelope.prototype.setInput=function(){for(var i=0;i<arguments.length;i++)this.connect(arguments[i])},p5.Envelope.prototype.setExp=function(i){this.isExponential=i},p5.Envelope.prototype.checkExpInput=function(i){return i<=0&&(i=1e-8),i},p5.Envelope.prototype.play=function(i,e,t){var n=e||0;i&&this.connection!==i&&this.connect(i),this.triggerAttack(i,n),this.triggerRelease(i,n+this.aTime+this.dTime+~~t)},p5.Envelope.prototype.triggerAttack=function(i,e){var t=a.audiocontext.currentTime,n=e||0,s=t+n;this.lastAttack=s,this.wasTriggered=!0,i&&this.connection!==i&&this.connect(i);var u=this.control.getValueAtTime(s);this.isExponential===!0?this.control.exponentialRampToValueAtTime(this.checkExpInput(u),s):this.control.linearRampToValueAtTime(u,s),s+=this.aTime,this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),s),u=this.checkExpInput(this.control.getValueAtTime(s)),this.control.cancelScheduledValues(s),this.control.exponentialRampToValueAtTime(u,s)):(this.control.linearRampToValueAtTime(this.aLevel,s),u=this.control.getValueAtTime(s),this.control.cancelScheduledValues(s),this.control.linearRampToValueAtTime(u,s)),s+=this.dTime,this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),s),u=this.checkExpInput(this.control.getValueAtTime(s)),this.control.cancelScheduledValues(s),this.control.exponentialRampToValueAtTime(u,s)):(this.control.linearRampToValueAtTime(this.dLevel,s),u=this.control.getValueAtTime(s),this.control.cancelScheduledValues(s),this.control.linearRampToValueAtTime(u,s))},p5.Envelope.prototype.triggerRelease=function(i,e){if(this.wasTriggered){var t=a.audiocontext.currentTime,n=e||0,s=t+n;i&&this.connection!==i&&this.connect(i);var u=this.control.getValueAtTime(s);this.isExponential===!0?this.control.exponentialRampToValueAtTime(this.checkExpInput(u),s):this.control.linearRampToValueAtTime(u,s),s+=this.rTime,this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),s),u=this.checkExpInput(this.control.getValueAtTime(s)),this.control.cancelScheduledValues(s),this.control.exponentialRampToValueAtTime(u,s)):(this.control.linearRampToValueAtTime(this.rLevel,s),u=this.control.getValueAtTime(s),this.control.cancelScheduledValues(s),this.control.linearRampToValueAtTime(u,s)),this.wasTriggered=!1}},p5.Envelope.prototype.ramp=function(i,e,t,n){var s=a.audiocontext.currentTime,u=e||0,m=s+u,v=this.checkExpInput(t),b=typeof n<"u"?this.checkExpInput(n):void 0;i&&this.connection!==i&&this.connect(i);var P=this.checkExpInput(this.control.getValueAtTime(m));v>P?(this.control.setTargetAtTime(v,m,this._rampAttackTC),m+=this._rampAttackTime):v<P&&(this.control.setTargetAtTime(v,m,this._rampDecayTC),m+=this._rampDecayTime),b!==void 0&&(b>v?this.control.setTargetAtTime(b,m,this._rampAttackTC):b<v&&this.control.setTargetAtTime(b,m,this._rampDecayTC))},p5.Envelope.prototype.connect=function(i){this.connection=i,(i instanceof p5.Oscillator||i instanceof p5.SoundFile||i instanceof p5.AudioIn||i instanceof p5.Reverb||i instanceof p5.Noise||i instanceof p5.Filter||i instanceof p5.Delay)&&(i=i.output.gain),i instanceof AudioParam&&i.setValueAtTime(0,a.audiocontext.currentTime),this.output.connect(i)},p5.Envelope.prototype.disconnect=function(){this.output&&this.output.disconnect()},p5.Envelope.prototype.add=function(i){var e=new at.a(i),t=this.mathOps.length,n=this.output;return p5.prototype._mathChain(this,e,t,n,at.a)},p5.Envelope.prototype.mult=function(i){var e=new Z.a(i),t=this.mathOps.length,n=this.output;return p5.prototype._mathChain(this,e,t,n,Z.a)},p5.Envelope.prototype.scale=function(i,e,t,n){var s=new ut.a(i,e,t,n),u=this.mathOps.length,m=this.output;return p5.prototype._mathChain(this,s,u,m,ut.a)},p5.Envelope.prototype.dispose=function(){var i=a.soundArray.indexOf(this);a.soundArray.splice(i,1),this.disconnect(),this.control&&(this.control.dispose(),this.control=null);for(var e=1;e<this.mathOps.length;e++)this.mathOps[e].dispose()},p5.Env=function(i,e,t,n,s,u){console.warn("WARNING: p5.Env is now deprecated and may be removed in future versions. Please use the new p5.Envelope instead."),p5.Envelope.call(this,i,e,t,n,s,u)},p5.Env.prototype=Object.create(p5.Envelope.prototype);var kn=p5.Envelope,On=kn;function pt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pt=function(t){return typeof t}:pt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(i)}function En(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Cn(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Rn(i,e,t){return e&&Cn(i.prototype,e),i}function Nn(i,e){return e&&(pt(e)==="object"||typeof e=="function")?e:Dn(i)}function Dn(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function zt(i){return zt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},zt(i)}function Fn(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&Kt(i,e)}function Kt(i,e){return Kt=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},Kt(i,e)}var Zt=function(){for(var i=2*a.audiocontext.sampleRate,e=a.audiocontext.createBuffer(1,i,a.audiocontext.sampleRate),t=e.getChannelData(0),n=0;n<i;n++)t[n]=Math.random()*2-1;return e.type="white",e}(),_e=function(){var i=2*a.audiocontext.sampleRate,e=a.audiocontext.createBuffer(1,i,a.audiocontext.sampleRate),t=e.getChannelData(0),n,s,u,m,v,b,P;n=s=u=m=v=b=P=0;for(var x=0;x<i;x++){var C=Math.random()*2-1;n=.99886*n+C*.0555179,s=.99332*s+C*.0750759,u=.969*u+C*.153852,m=.8665*m+C*.3104856,v=.55*v+C*.5329522,b=-.7616*b-C*.016898,t[x]=n+s+u+m+v+b+P+C*.5362,t[x]*=.11,P=C*.115926}return e.type="pink",e}(),ge=function(){for(var i=2*a.audiocontext.sampleRate,e=a.audiocontext.createBuffer(1,i,a.audiocontext.sampleRate),t=e.getChannelData(0),n=0,s=0;s<i;s++){var u=Math.random()*2-1;t[s]=(n+.02*u)/1.02,n=t[s],t[s]*=3.5}return e.type="brown",e}(),Bn=function(i){Fn(e,i);function e(t){var n;En(this,e),n=Nn(this,zt(e).call(this));var s;return delete n.f,delete n.freq,delete n.oscillator,t==="brown"?s=ge:t==="pink"?s=_e:s=Zt,n.buffer=s,n}return Rn(e,[{key:"setType",value:function(n){switch(n){case"white":this.buffer=Zt;break;case"pink":this.buffer=_e;break;case"brown":this.buffer=ge;break;default:this.buffer=Zt}if(this.started){var s=a.audiocontext.currentTime;this.stop(s),this.start(s+.01)}}},{key:"getType",value:function(){return this.buffer.type}},{key:"start",value:function(){this.started&&this.stop(),this.noise=a.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var n=a.audiocontext.currentTime;this.noise.start(n),this.started=!0}},{key:"stop",value:function(){var n=a.audiocontext.currentTime;this.noise&&(this.noise.stop(n),this.started=!1)}},{key:"dispose",value:function(){var n=a.audiocontext.currentTime,s=a.soundArray.indexOf(this);a.soundArray.splice(s,1),this.noise&&(this.noise.disconnect(),this.stop(n)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}]),e}(ht),Mn=Bn,In=h(2),qn=h.n(In);function dt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?dt=function(t){return typeof t}:dt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dt(i)}function Un(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Vn(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ln(i,e,t){return e&&Vn(i.prototype,e),i}function jn(i,e){return e&&(dt(e)==="object"||typeof e=="function")?e:Wn(i)}function Wn(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Xt(i){return Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Xt(i)}function Gn(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&Qt(i,e)}function Qt(i,e){return Qt=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},Qt(i,e)}var Yn=function(i){Gn(e,i);function e(t,n){var s;Un(this,e),s=jn(this,Xt(e).call(this,t,"sawtooth")),s.w=n||0,s.osc2=new ve(t),s.dNode=a.audiocontext.createDelay(),s.dcOffset=be(),s.dcGain=a.audiocontext.createGain(),s.dcOffset.connect(s.dcGain),s.dcGain.connect(s.output),s.f=t||440;var u=s.w/s.oscillator.frequency.value;return s.dNode.delayTime.value=u,s.dcGain.gain.value=1.7*(.5-s.w),s.osc2.disconnect(),s.osc2.panner.disconnect(),s.osc2.amp(-1),s.osc2.output.connect(s.dNode),s.dNode.connect(s.output),s.output.gain.value=1,s.output.connect(s.panner),s}return Ln(e,[{key:"width",value:function(n){if(typeof n=="number"){if(n<=1&&n>=0){this.w=n;var s=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=s}this.dcGain.gain.value=1.7*(.5-this.w)}else{n.connect(this.dNode.delayTime);var u=new qn.a(-.5);n.connect(u);var m=new Z.a(-1),v=new Z.a(1.7);u=u.connect(m).connect(v),u.connect(this.dcGain.gain)}}},{key:"start",value:function(n,s){var u=a.audiocontext.currentTime,m=s||0;if(!this.started){var v=n||this.f,b=this.oscillator.type;this.oscillator=a.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(v,u),this.oscillator.type=b,this.oscillator.connect(this.output),this.oscillator.start(m+u),this.osc2.oscillator=a.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(v,m+u),this.osc2.oscillator.type=b,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(m+u),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=be(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(m+u),this.mods!==void 0&&this.mods.frequency!==void 0&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}}},{key:"stop",value:function(n){if(this.started){var s=n||0,u=a.audiocontext.currentTime;this.oscillator.stop(s+u),this.osc2.oscillator&&this.osc2.oscillator.stop(s+u),this.dcOffset.stop(s+u),this.started=!1,this.osc2.started=!1}}},{key:"freq",value:function(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(typeof n=="number"){this.f=n;var m=a.audiocontext.currentTime,v=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(m),this.oscillator.frequency.setValueAtTime(v,m+u),this.oscillator.frequency.exponentialRampToValueAtTime(n,u+s+m),this.osc2.oscillator.frequency.cancelScheduledValues(m),this.osc2.oscillator.frequency.setValueAtTime(v,m+u),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(n,u+s+m),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else n.output&&(n.output.disconnect(),n.output.connect(this.oscillator.frequency),n.output.connect(this.osc2.oscillator.frequency),this.freqMod=n)}}]),e}(ht);function be(){for(var i=a.audiocontext,e=i.createBuffer(1,2048,i.sampleRate),t=e.getChannelData(0),n=0;n<2048;n++)t[n]=1;var s=i.createBufferSource();return s.buffer=e,s.loop=!0,s}var zn=Yn;function Kn(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Zn(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Xn(i,e,t){return e&&Zn(i.prototype,e),i}a.inputSources=[];var Qn=function(){function i(e){Kn(this,i),this.input=a.audiocontext.createGain(),this.output=a.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=null,this.enabled=!1,this.amplitude=new ye,this.output.connect(this.amplitude.input),(!window.MediaStreamTrack||!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)&&(e?e():window.alert("This browser does not support MediaStreamTrack and mediaDevices")),a.soundArray.push(this)}return Xn(i,[{key:"start",value:function(t,n){var s=this;this.stream&&this.stop();var u=a.inputSources[s.currentSource],m={audio:{sampleRate:a.audiocontext.sampleRate,echoCancellation:!1}};a.inputSources[this.currentSource]&&(m.audio.deviceId=u.deviceId),window.navigator.mediaDevices.getUserMedia(m).then(function(v){s.stream=v,s.enabled=!0,s.mediaStream=a.audiocontext.createMediaStreamSource(v),s.mediaStream.connect(s.output),s.amplitude.setInput(s.output),t&&t()}).catch(function(v){n?n(v):console.error(v)})}},{key:"stop",value:function(){this.stream&&(this.stream.getTracks().forEach(function(t){t.stop()}),this.mediaStream.disconnect(),delete this.mediaStream,delete this.stream)}},{key:"connect",value:function(t){t?t.hasOwnProperty("input")?this.output.connect(t.input):t.hasOwnProperty("analyser")?this.output.connect(t.analyser):this.output.connect(t):this.output.connect(a.input)}},{key:"disconnect",value:function(){this.output&&(this.output.disconnect(),this.output.connect(this.amplitude.input))}},{key:"getLevel",value:function(t){return t&&(this.amplitude.smoothing=t),this.amplitude.getLevel()}},{key:"amp",value:function(t,n){if(n){var s=n||0,u=this.output.gain.value;this.output.gain.cancelScheduledValues(a.audiocontext.currentTime),this.output.gain.setValueAtTime(u,a.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(t,s+a.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(a.audiocontext.currentTime),this.output.gain.setValueAtTime(t,a.audiocontext.currentTime)}},{key:"getSources",value:function(t,n){return new Promise(function(s,u){window.navigator.mediaDevices.enumerateDevices().then(function(m){a.inputSources=m.filter(function(v){return v.kind==="audioinput"}),s(a.inputSources),t&&t(a.inputSources)}).catch(function(m){u(m),n?n(m):console.error("This browser does not support MediaStreamTrack.getSources()")})})}},{key:"setSource",value:function(t){a.inputSources.length>0&&t<a.inputSources.length?(this.currentSource=t,console.log("set source to ",a.inputSources[this.currentSource])):console.log("unable to set input source"),this.stream&&this.stream.active&&this.start()}},{key:"dispose",value:function(){var t=a.soundArray.indexOf(this);a.soundArray.splice(t,1),this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),delete this.amplitude,delete this.output}}]),i}(),Hn=Qn,$n=h(23),Jn=h.n($n);function ti(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function ei(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function ni(i,e,t){return e&&ei(i.prototype,e),i}var ii=function(){function i(){ti(this,i),this.ac=a.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._drywet=new Jn.a(1),this.wet=this.ac.createGain(),this.input.connect(this._drywet.a),this.wet.connect(this._drywet.b),this._drywet.connect(this.output),this.connect(),a.soundArray.push(this)}return ni(i,[{key:"amp",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=a.audiocontext.currentTime,m=u+s,v=m+n+.001,b=this.output.gain.value;this.output.gain.cancelScheduledValues(u),this.output.gain.linearRampToValueAtTime(b,m+.001),this.output.gain.linearRampToValueAtTime(t,v)}},{key:"chain",value:function(){if(arguments.length>0){this.connect(arguments[0]);for(var t=1;t<arguments.length;t+=1)arguments[t-1].connect(arguments[t])}return this}},{key:"drywet",value:function(t){return typeof t<"u"&&(this._drywet.fade.value=t),this._drywet.fade.value}},{key:"connect",value:function(t){var n=t||p5.soundOut.input;this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"dispose",value:function(){var t=a.soundArray.indexOf(this);a.soundArray.splice(t,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),this._drywet&&(this._drywet.disconnect(),delete this._drywet),this.wet&&(this.wet.disconnect(),delete this.wet),this.ac=void 0}}]),i}(),W=ii;function mt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?mt=function(t){return typeof t}:mt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(i)}function yt(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function ri(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function oi(i,e,t){return e&&ri(i.prototype,e),i}function vt(i,e){return e&&(mt(e)==="object"||typeof e=="function")?e:si(i)}function si(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function _t(i,e,t){return typeof Reflect<"u"&&Reflect.get?_t=Reflect.get:_t=function(s,u,m){var v=ai(s,u);if(v){var b=Object.getOwnPropertyDescriptor(v,u);return b.get?b.get.call(m):b.value}},_t(i,e,t||i)}function ai(i,e){for(;!Object.prototype.hasOwnProperty.call(i,e)&&(i=G(i),i!==null););return i}function G(i){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},G(i)}function gt(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&Ht(i,e)}function Ht(i,e){return Ht=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},Ht(i,e)}var bt=function(i){gt(e,i);function e(t){var n;return yt(this,e),n=vt(this,G(e).call(this)),n.biquad=n.ac.createBiquadFilter(),n.input.connect(n.biquad),n.biquad.connect(n.wet),t&&n.setType(t),n._on=!0,n._untoggledType=n.biquad.type,n}return oi(e,[{key:"process",value:function(n,s,u,m){n.connect(this.input),this.set(s,u,m)}},{key:"set",value:function(n,s,u){n&&this.freq(n,u),s&&this.res(s,u)}},{key:"freq",value:function(n,s){var u=s||0;return n<=0&&(n=1),typeof n=="number"?(this.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+u),this.biquad.frequency.exponentialRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.biquad.frequency),this.biquad.frequency.value}},{key:"res",value:function(n,s){var u=s||0;return typeof n=="number"?(this.biquad.Q.value=n,this.biquad.Q.cancelScheduledValues(this.ac.currentTime+.01+u),this.biquad.Q.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.biquad.Q),this.biquad.Q.value}},{key:"gain",value:function(n,s){var u=s||0;return typeof n=="number"?(this.biquad.gain.value=n,this.biquad.gain.cancelScheduledValues(this.ac.currentTime+.01+u),this.biquad.gain.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.biquad.gain),this.biquad.gain.value}},{key:"toggle",value:function(){return this._on=!this._on,this._on===!0?this.biquad.type=this._untoggledType:this._on===!1&&(this.biquad.type="allpass"),this._on}},{key:"setType",value:function(n){this.biquad.type=n,this._untoggledType=this.biquad.type}},{key:"dispose",value:function(){_t(G(e.prototype),"dispose",this).call(this),this.biquad&&(this.biquad.disconnect(),delete this.biquad)}}]),e}(W),ui=function(i){gt(e,i);function e(){return yt(this,e),vt(this,G(e).call(this,"lowpass"))}return e}(bt),ci=function(i){gt(e,i);function e(){return yt(this,e),vt(this,G(e).call(this,"highpass"))}return e}(bt),li=function(i){gt(e,i);function e(){return yt(this,e),vt(this,G(e).call(this,"bandpass"))}return e}(bt),Tt=bt;function wt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?wt=function(t){return typeof t}:wt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wt(i)}function fi(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function hi(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function pi(i,e,t){return e&&hi(i.prototype,e),i}function di(i,e){return e&&(wt(e)==="object"||typeof e=="function")?e:mi(i)}function mi(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function $t(i){return $t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$t(i)}function yi(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&Jt(i,e)}function Jt(i,e){return Jt=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},Jt(i,e)}var vi=function(i){yi(e,i);function e(t,n){var s;return fi(this,e),s=di(this,$t(e).call(this,"peaking")),s.disconnect(),s.set(t,n),s.biquad.gain.value=0,delete s.input,delete s.output,delete s._drywet,delete s.wet,s}return pi(e,[{key:"amp",value:function(){console.warn("`amp()` is not available for p5.EQ bands. Use `.gain()`")}},{key:"drywet",value:function(){console.warn("`drywet()` is not available for p5.EQ bands.")}},{key:"connect",value:function(n){var s=n||p5.soundOut.input;this.biquad?this.biquad.connect(s.input?s.input:s):this.output.connect(s.input?s.input:s)}},{key:"disconnect",value:function(){this.biquad&&this.biquad.disconnect()}},{key:"dispose",value:function(){var n=a.soundArray.indexOf(this);a.soundArray.splice(n,1),this.disconnect(),delete this.biquad}}]),e}(Tt),_i=vi;function St(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?St=function(t){return typeof t}:St=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},St(i)}function gi(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function bi(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ti(i,e,t){return e&&bi(i.prototype,e),i}function wi(i,e){return e&&(St(e)==="object"||typeof e=="function")?e:Si(i)}function Si(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function At(i,e,t){return typeof Reflect<"u"&&Reflect.get?At=Reflect.get:At=function(s,u,m){var v=Ai(s,u);if(v){var b=Object.getOwnPropertyDescriptor(v,u);return b.get?b.get.call(m):b.value}},At(i,e,t||i)}function Ai(i,e){for(;!Object.prototype.hasOwnProperty.call(i,e)&&(i=$(i),i!==null););return i}function $(i){return $=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$(i)}function Pi(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&te(i,e)}function te(i,e){return te=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},te(i,e)}var xi=function(i){Pi(e,i);function e(t){var n;gi(this,e),n=wi(this,$(e).call(this)),t=t===3||t===8?t:3;var s;t===3?s=Math.pow(2,3):s=2,n.bands=[];for(var u,m,v=0;v<t;v++)v===t-1?(u=21e3,m=.01):v===0?(u=100,m=.1):v===1?(u=t===3?360*s:360,m=1):(u=n.bands[v-1].freq()*s,m=1),n.bands[v]=n._newBand(u,m),v>0?n.bands[v-1].connect(n.bands[v].biquad):n.input.connect(n.bands[v].biquad);return n.bands[t-1].connect(n.output),n}return Ti(e,[{key:"process",value:function(n){n.connect(this.input)}},{key:"set",value:function(){if(arguments.length===this.bands.length*2)for(var n=0;n<arguments.length;n+=2)this.bands[n/2].freq(arguments[n]),this.bands[n/2].gain(arguments[n+1]);else console.error("Argument mismatch. .set() should be called with "+this.bands.length*2+" arguments. (one frequency and gain value pair for each band of the eq)")}},{key:"_newBand",value:function(n,s){return new _i(n,s)}},{key:"dispose",value:function(){if(At($(e.prototype),"dispose",this).call(this),this.bands){for(;this.bands.length>0;)delete this.bands.pop().dispose();delete this.bands}}}]),e}(W),ki=xi;function Oi(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Ei(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ci(i,e,t){return e&&Ei(i.prototype,e),i}var Ri=function(){function i(e){Oi(this,i),this.ac=a.audiocontext,this.listener=this.ac.listener}return Ci(i,[{key:"process",value:function(t){t.connect(this.input)}},{key:"position",value:function(t,n,s,u){return this.positionX(t,u),this.positionY(n,u),this.positionZ(s,u),[this.listener.positionX.value,this.listener.positionY.value,this.listener.positionZ.value]}},{key:"positionX",value:function(t,n){var s=n||0;return typeof t=="number"?(this.listener.positionX.value=t,this.listener.positionX.cancelScheduledValues(this.ac.currentTime+.01+s),this.listener.positionX.linearRampToValueAtTime(t,this.ac.currentTime+.02+s)):t&&t.connect(this.listener.positionX),this.listener.positionX.value}},{key:"positionY",value:function(t,n){var s=n||0;return typeof t=="number"?(this.listener.positionY.value=t,this.listener.positionY.cancelScheduledValues(this.ac.currentTime+.01+s),this.listener.positionY.linearRampToValueAtTime(t,this.ac.currentTime+.02+s)):t&&t.connect(this.listener.positionY),this.listener.positionY.value}},{key:"positionZ",value:function(t,n){var s=n||0;return typeof t=="number"?(this.listener.positionZ.value=t,this.listener.positionZ.cancelScheduledValues(this.ac.currentTime+.01+s),this.listener.positionZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+s)):t&&t.connect(this.listener.positionZ),this.listener.positionZ.value}},{key:"orient",value:function(t,n,s,u,m,v,b){return arguments.length===3||arguments.length===4?(b=arguments[3],this.orientForward(t,n,s,b)):(arguments.length===6||arguments===7)&&(this.orientForward(t,n,s),this.orientUp(u,m,v,b)),[this.listener.forwardX.value,this.listener.forwardY.value,this.listener.forwardZ.value,this.listener.upX.value,this.listener.upY.value,this.listener.upZ.value]}},{key:"orientForward",value:function(t,n,s,u){return this.forwardX(t,u),this.forwardY(n,u),this.forwardZ(s,u),[this.listener.forwardX,this.listener.forwardY,this.listener.forwardZ]}},{key:"orientUp",value:function(t,n,s,u){return this.upX(t,u),this.upY(n,u),this.upZ(s,u),[this.listener.upX,this.listener.upY,this.listener.upZ]}},{key:"forwardX",value:function(t,n){var s=n||0;return typeof t=="number"?(this.listener.forwardX.value=t,this.listener.forwardX.cancelScheduledValues(this.ac.currentTime+.01+s),this.listener.forwardX.linearRampToValueAtTime(t,this.ac.currentTime+.02+s)):t&&t.connect(this.listener.forwardX),this.listener.forwardX.value}},{key:"forwardY",value:function(t,n){var s=n||0;return typeof t=="number"?(this.listener.forwardY.value=t,this.listener.forwardY.cancelScheduledValues(this.ac.currentTime+.01+s),this.listener.forwardY.linearRampToValueAtTime(t,this.ac.currentTime+.02+s)):t&&t.connect(this.listener.forwardY),this.listener.forwardY.value}},{key:"forwardZ",value:function(t,n){var s=n||0;return typeof t=="number"?(this.listener.forwardZ.value=t,this.listener.forwardZ.cancelScheduledValues(this.ac.currentTime+.01+s),this.listener.forwardZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+s)):t&&t.connect(this.listener.forwardZ),this.listener.forwardZ.value}},{key:"upX",value:function(t,n){var s=n||0;return typeof t=="number"?(this.listener.upX.value=t,this.listener.upX.cancelScheduledValues(this.ac.currentTime+.01+s),this.listener.upX.linearRampToValueAtTime(t,this.ac.currentTime+.02+s)):t&&t.connect(this.listener.upX),this.listener.upX.value}},{key:"upY",value:function(t,n){var s=n||0;return typeof t=="number"?(this.listener.upY.value=t,this.listener.upY.cancelScheduledValues(this.ac.currentTime+.01+s),this.listener.upY.linearRampToValueAtTime(t,this.ac.currentTime+.02+s)):t&&t.connect(this.listener.upY),this.listener.upY.value}},{key:"upZ",value:function(t,n){var s=n||0;return typeof t=="number"?(this.listener.upZ.value=t,this.listener.upZ.cancelScheduledValues(this.ac.currentTime+.01+s),this.listener.upZ.linearRampToValueAtTime(t,this.ac.currentTime+.02+s)):t&&t.connect(this.listener.upZ),this.listener.upZ.value}}]),i}(),Ni=Ri;function Pt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Pt=function(t){return typeof t}:Pt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt(i)}function Di(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Fi(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Bi(i,e,t){return e&&Fi(i.prototype,e),i}function Mi(i,e){return e&&(Pt(e)==="object"||typeof e=="function")?e:Ii(i)}function Ii(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function xt(i,e,t){return typeof Reflect<"u"&&Reflect.get?xt=Reflect.get:xt=function(s,u,m){var v=qi(s,u);if(v){var b=Object.getOwnPropertyDescriptor(v,u);return b.get?b.get.call(m):b.value}},xt(i,e,t||i)}function qi(i,e){for(;!Object.prototype.hasOwnProperty.call(i,e)&&(i=J(i),i!==null););return i}function J(i){return J=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},J(i)}function Ui(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&ee(i,e)}function ee(i,e){return ee=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},ee(i,e)}var Vi=function(i){Ui(e,i);function e(){var t;return Di(this,e),t=Mi(this,J(e).call(this)),t.panner=t.ac.createPanner(),t.panner.panningModel="HRTF",t.panner.distanceModel="linear",t.panner.connect(t.output),t.input.connect(t.panner),t}return Bi(e,[{key:"process",value:function(n){n.connect(this.input)}},{key:"set",value:function(n,s,u,m){return this.positionX(n,m),this.positionY(s,m),this.positionZ(u,m),[this.panner.positionX.value,this.panner.positionY.value,this.panner.positionZ.value]}},{key:"positionX",value:function(n,s){var u=s||0;return typeof n=="number"?(this.panner.positionX.value=n,this.panner.positionX.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.positionX.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.positionX),this.panner.positionX.value}},{key:"positionY",value:function(n,s){var u=s||0;return typeof n=="number"?(this.panner.positionY.value=n,this.panner.positionY.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.positionY.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.positionY),this.panner.positionY.value}},{key:"positionZ",value:function(n,s){var u=s||0;return typeof n=="number"?(this.panner.positionZ.value=n,this.panner.positionZ.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.positionZ.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.positionZ),this.panner.positionZ.value}},{key:"orient",value:function(n,s,u,m){return this.orientX(n,m),this.orientY(s,m),this.orientZ(u,m),[this.panner.orientationX.value,this.panner.orientationY.value,this.panner.orientationZ.value]}},{key:"orientX",value:function(n,s){var u=s||0;return typeof n=="number"?(this.panner.orientationX.value=n,this.panner.orientationX.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.orientationX.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.orientationX),this.panner.orientationX.value}},{key:"orientY",value:function(n,s){var u=s||0;return typeof n=="number"?(this.panner.orientationY.value=n,this.panner.orientationY.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.orientationY.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.orientationY),this.panner.orientationY.value}},{key:"orientZ",value:function(n,s){var u=s||0;return typeof n=="number"?(this.panner.orientationZ.value=n,this.panner.orientationZ.cancelScheduledValues(this.ac.currentTime+.01+u),this.panner.orientationZ.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):n&&n.connect(this.panner.orientationZ),this.panner.orientationZ.value}},{key:"setFalloff",value:function(n,s){this.maxDist(n),this.rolloff(s)}},{key:"maxDist",value:function(n){return typeof n=="number"&&(this.panner.maxDistance=n),this.panner.maxDistance}},{key:"rolloff",value:function(n){return typeof n=="number"&&(this.panner.rolloffFactor=n),this.panner.rolloffFactor}},{key:"dispose",value:function(){xt(J(e.prototype),"dispose",this).call(this),this.panner&&(this.panner.disconnect(),delete this.panner)}}]),e}(W),Li=Vi;function kt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?kt=function(t){return typeof t}:kt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(i)}function ji(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Wi(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Gi(i,e,t){return e&&Wi(i.prototype,e),i}function Yi(i,e){return e&&(kt(e)==="object"||typeof e=="function")?e:zi(i)}function zi(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Ot(i,e,t){return typeof Reflect<"u"&&Reflect.get?Ot=Reflect.get:Ot=function(s,u,m){var v=Ki(s,u);if(v){var b=Object.getOwnPropertyDescriptor(v,u);return b.get?b.get.call(m):b.value}},Ot(i,e,t||i)}function Ki(i,e){for(;!Object.prototype.hasOwnProperty.call(i,e)&&(i=tt(i),i!==null););return i}function tt(i){return tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},tt(i)}function Zi(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&ne(i,e)}function ne(i,e){return ne=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},ne(i,e)}var Xi=function(i){Zi(e,i);function e(){var t;return ji(this,e),t=Yi(this,tt(e).call(this)),t._split=t.ac.createChannelSplitter(2),t._merge=t.ac.createChannelMerger(2),t._leftGain=t.ac.createGain(),t._rightGain=t.ac.createGain(),t.leftDelay=t.ac.createDelay(),t.rightDelay=t.ac.createDelay(),t._leftFilter=new Tt,t._rightFilter=new Tt,t._leftFilter.disconnect(),t._rightFilter.disconnect(),t._leftFilter.biquad.frequency.setValueAtTime(1200,t.ac.currentTime),t._rightFilter.biquad.frequency.setValueAtTime(1200,t.ac.currentTime),t._leftFilter.biquad.Q.setValueAtTime(.3,t.ac.currentTime),t._rightFilter.biquad.Q.setValueAtTime(.3,t.ac.currentTime),t.input.connect(t._split),t.leftDelay.connect(t._leftGain),t.rightDelay.connect(t._rightGain),t._leftGain.connect(t._leftFilter.input),t._rightGain.connect(t._rightFilter.input),t._merge.connect(t.wet),t._leftFilter.biquad.gain.setValueAtTime(1,t.ac.currentTime),t._rightFilter.biquad.gain.setValueAtTime(1,t.ac.currentTime),t.setType(0),t._maxDelay=t.leftDelay.delayTime.maxValue,t.feedback(.5),t}return Gi(e,[{key:"process",value:function(n,s,u,m){var v=u||0,b=s||0;if(v>=1)throw new Error("Feedback value will force a positive feedback loop.");if(b>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");n.connect(this.input),this.leftDelay.delayTime.setValueAtTime(b,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(b,this.ac.currentTime),this._leftGain.gain.value=v,this._rightGain.gain.value=v,m&&(this._leftFilter.freq(m),this._rightFilter.freq(m))}},{key:"delayTime",value:function(n){typeof n!="number"?(n.connect(this.leftDelay.delayTime),n.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(n,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(n,this.ac.currentTime))}},{key:"feedback",value:function(n){if(n&&typeof n!="number")n.connect(this._leftGain.gain),n.connect(this._rightGain.gain);else{if(n>=1)throw new Error("Feedback value will force a positive feedback loop.");typeof n=="number"&&(this._leftGain.gain.value=n,this._rightGain.gain.value=n)}return this._leftGain.gain.value}},{key:"filter",value:function(n,s){this._leftFilter.set(n,s),this._rightFilter.set(n,s)}},{key:"setType",value:function(n){switch(n===1&&(n="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),n){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._rightFilter.output.connect(this.rightDelay)}}},{key:"dispose",value:function(){Ot(tt(e.prototype),"dispose",this).call(this),this._split.disconnect(),this._leftFilter.dispose(),this._rightFilter.dispose(),this._merge.disconnect(),this._leftGain.disconnect(),this._rightGain.disconnect(),this.leftDelay.disconnect(),this.rightDelay.disconnect(),this._split=void 0,this._leftFilter=void 0,this._rightFilter=void 0,this._merge=void 0,this._leftGain=void 0,this._rightGain=void 0,this.leftDelay=void 0,this.rightDelay=void 0}}]),e}(W),Qi=Xi;function Et(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Et=function(t){return typeof t}:Et=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Et(i)}function Te(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Hi(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function we(i,e,t){return e&&Hi(i.prototype,e),i}function Se(i,e){return e&&(Et(e)==="object"||typeof e=="function")?e:$i(i)}function $i(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function et(i,e,t){return typeof Reflect<"u"&&Reflect.get?et=Reflect.get:et=function(s,u,m){var v=Ji(s,u);if(v){var b=Object.getOwnPropertyDescriptor(v,u);return b.get?b.get.call(m):b.value}},et(i,e,t||i)}function Ji(i,e){for(;!Object.prototype.hasOwnProperty.call(i,e)&&(i=Y(i),i!==null););return i}function Y(i){return Y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Y(i)}function Ae(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&ie(i,e)}function ie(i,e){return ie=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},ie(i,e)}var Pe=function(i){Ae(e,i);function e(){var t;return Te(this,e),t=Se(this,Y(e).call(this)),t._initConvolverNode(),t.input.gain.value=.5,t._seconds=3,t._decay=2,t._reverse=!1,t._buildImpulse(),t}return we(e,[{key:"_initConvolverNode",value:function(){this.convolverNode=this.ac.createConvolver(),this.input.connect(this.convolverNode),this.convolverNode.connect(this.wet)}},{key:"_teardownConvolverNode",value:function(){this.convolverNode&&(this.convolverNode.disconnect(),delete this.convolverNode)}},{key:"_setBuffer",value:function(n){this._teardownConvolverNode(),this._initConvolverNode(),this.convolverNode.buffer=n}},{key:"process",value:function(n,s,u,m){n.connect(this.input);var v=!1;s&&(this._seconds=s,v=!0),u&&(this._decay=u),m&&(this._reverse=m),v&&this._buildImpulse()}},{key:"set",value:function(n,s,u){var m=!1;n&&(this._seconds=n,m=!0),s&&(this._decay=s),u&&(this._reverse=u),m&&this._buildImpulse()}},{key:"_buildImpulse",value:function(){var n=this.ac.sampleRate,s=n*this._seconds,u=this._decay,m=this.ac.createBuffer(2,s,n),v=m.getChannelData(0),b=m.getChannelData(1),P,x;for(x=0;x<s;x++)P=this._reverse?s-x:x,v[x]=(Math.random()*2-1)*Math.pow(1-P/s,u),b[x]=(Math.random()*2-1)*Math.pow(1-P/s,u);this._setBuffer(m)}},{key:"dispose",value:function(){et(Y(e.prototype),"dispose",this).call(this),this._teardownConvolverNode()}}]),e}(W),xe=function(i){Ae(e,i);function e(t,n,s){var u;return Te(this,e),u=Se(this,Y(e).call(this)),u._initConvolverNode(),u.input.gain.value=.5,t?(u.impulses=[],u._loadBuffer(t,n,s)):(u._seconds=3,u._decay=2,u._reverse=!1,u._buildImpulse()),u.impulses=[],u.set=null,u}return we(e,[{key:"_loadBuffer",value:function(n,s,u){var m=p5.prototype._checkFileFormats(n),v=this,b=new Error().stack,P=Object(g.b)(),x=new XMLHttpRequest;x.open("GET",m,!0),x.responseType="arraybuffer",x.onload=function(){if(x.status===200)P.decodeAudioData(x.response,function(B){var q={},j=m.split("/");q.name=j[j.length-1],q.audioBuffer=B,v.impulses.push(q),v._setBuffer(q.audioBuffer),s&&s(q)},function(){var B=new K("decodeAudioData",b,v.url),q="AudioContext error at decodeAudioData for "+v.url;u?(B.msg=q,u(B)):console.error(q+`
 The error stack trace includes: 
`+B.stack)});else{var C=new K("loadConvolver",b,v.url),V="Unable to load "+v.url+". The request status was: "+x.status+" ("+x.statusText+")";u?(C.message=V,u(C)):console.error(V+`
 The error stack trace includes: 
`+C.stack)}},x.onerror=function(){var C=new K("loadConvolver",b,v.url),V="There was no response from the server at "+v.url+". Check the url and internet connectivity.";u?(C.message=V,u(C)):console.error(V+`
 The error stack trace includes: 
`+C.stack)},x.send()}},{key:"process",value:function(n){n.connect(this.input)}},{key:"addImpulse",value:function(n,s,u){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(n,s,u)}},{key:"resetImpulse",value:function(n,s,u){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(n,s,u)}},{key:"toggleImpulse",value:function(n){if(typeof n=="number"&&n<this.impulses.length&&this._setBuffer(this.impulses[n].audioBuffer),typeof n=="string"){for(var s=0;s<this.impulses.length;s++)if(this.impulses[s].name===n){this._setBuffer(this.impulses[s].audioBuffer);break}}}},{key:"dispose",value:function(){et(Y(e.prototype),"dispose",this).call(this);for(var n in this.impulses)this.impulses[n]&&(this.impulses[n]=null)}}]),e}(Pe);function tr(i,e,t){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var n=this,s=new xe(i,function(u){typeof e=="function"&&e(u),typeof n._decrementPreload=="function"&&n._decrementPreload()},t);return s.impulses=[],s}var er=h(11),ke=h.n(er);function nr(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function ir(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function rr(i,e,t){return e&&ir(i.prototype,e),i}var or=function(){function i(){nr(this,i),this.clock=new ke.a({callback:this.ontick.bind(this)}),this.syncedParts=[],this.bpm=120,this._init(),this.prevTick=0,this.tatumTime=0,this.tickCallback=function(){}}return rr(i,[{key:"ontick",value:function(t){var n=t-this.prevTick,s=t-a.audiocontext.currentTime;if(!(n-this.tatumTime<=-.02)){this.prevTick=t;var u=this;this.syncedParts.forEach(function(m){m.isPlaying&&(m.incrementStep(s),m.phrases.forEach(function(v){var b=v.sequence,P=u.metroTicks%b.length;b[P]!==0&&(u.metroTicks<b.length||!v.looping)&&v.callback(s,b[P])}))}),this.metroTicks+=1,this.tickCallback(s)}}},{key:"setBPM",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=60/(t*this.tatums),u=a.audiocontext.currentTime;this.tatumTime=s,this.clock.frequency.setValueAtTime(this.clock.frequency.value,u),this.clock.frequency.linearRampToValueAtTime(t,u+n),this.bpm=t}},{key:"getBPM",value:function(){return this.clock.getRate()/this.tatums*60}},{key:"_init",value:function(){this.metroTicks=0}},{key:"resetSync",value:function(t){this.syncedParts=[t]}},{key:"pushSync",value:function(t){this.syncedParts.push(t)}},{key:"start",value:function(t){var n=t||0,s=a.audiocontext.currentTime;this.clock.start(s+n),this.setBPM(this.bpm)}},{key:"stop",value:function(t){var n=t||0,s=a.audiocontext.currentTime;this.clock.stop(s+n)}},{key:"beatLength",value:function(t){this.tatums=1/t/4}}]),i}(),Oe=or;function sr(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Ee(i,e,t){return e&&sr(i.prototype,e),i}function re(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var Ce=120;p5.prototype.setBPM=function(i,e){Ce=i;for(var t in a.parts)a.parts[t]&&a.parts[t].setBPM(i,e)};var oe=function i(e,t,n){re(this,i),this.phraseStep=0,this.name=e,this.callback=t,this.sequence=n},ar=function(){function i(e,t){re(this,i),this.length=e||0,this.partStep=0,this.phrases=[],this.isPlaying=!1,this.noLoop(),this.tatums=t||.0625,this.metro=new Oe,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(Ce),a.parts.push(this),this.callback=function(){}}return Ee(i,[{key:"setBPM",value:function(t,n){this.metro.setBPM(t,n)}},{key:"getBPM",value:function(){return this.metro.getBPM()}},{key:"start",value:function(t){if(!this.isPlaying){this.isPlaying=!0,this.metro.resetSync(this);var n=t||0;this.metro.start(n)}}},{key:"loop",value:function(t){this.looping=!0,this.onended=function(){this.partStep=0};var n=t||0;this.start(n)}},{key:"noLoop",value:function(){this.looping=!1,this.onended=function(){this.stop()}}},{key:"stop",value:function(t){this.partStep=0,this.pause(t)}},{key:"pause",value:function(t){this.isPlaying=!1;var n=t||0;this.metro.stop(n)}},{key:"addPhrase",value:function(t,n,s){var u;if(arguments.length===3)u=new oe(t,n,s);else if(arguments[0]instanceof oe)u=arguments[0];else throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";this.phrases.push(u),u.sequence.length>this.length&&(this.length=u.sequence.length)}},{key:"removePhrase",value:function(t){for(var n in this.phrases)this.phrases[n].name===t&&this.phrases.splice(n,1)}},{key:"getPhrase",value:function(t){for(var n in this.phrases)if(this.phrases[n].name===t)return this.phrases[n]}},{key:"replaceSequence",value:function(t,n){for(var s in this.phrases)this.phrases[s].name===t&&(this.phrases[s].sequence=n)}},{key:"incrementStep",value:function(t){this.partStep<this.length-1?(this.callback(t),this.partStep+=1):!this.looping&&this.partStep===this.length-1&&this.onended()}},{key:"onStep",value:function(t){this.callback=t}}]),i}(),ur=function(){function i(){re(this,i),this.parts=[],this.currentPart=new Array(arguments.length);var e=this;for(var t in arguments)this.parts[t]=arguments[t],this.parts[t].nextPart=this.parts[t+1],this.parts[t].onended=function(){e.resetPart(t),cr(e)};this.looping=!1}return Ee(i,[{key:"onended",value:function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0}},{key:"start",value:function(){this.parts[this.currentPart].start(),this.scoreStep=0}},{key:"stop",value:function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0}},{key:"pause",value:function(){this.parts[this.currentPart].stop()}},{key:"loop",value:function(){this.looping=!0,this.start()}},{key:"noLoop",value:function(){this.looping=!1}},{key:"resetParts",value:function(){var t=this;this.parts.forEach(function(n){t.resetParts[n]})}},{key:"resetPart",value:function(t){this.parts[t].stop(),this.parts[t].partStep=0;for(var n in this.parts[t].phrases)this.parts[t]&&(this.parts[t].phrases[n].phraseStep=0)}},{key:"setBPM",value:function(t,n){for(var s in this.parts)this.parts[s]&&this.parts[s].setBPM(t,n)}}]),i}();function cr(i){i.currentPart++,i.currentPart>=i.parts.length?(i.scoreStep=0,i.onended()):(i.scoreStep=0,i.parts[i.currentPart-1].stop(),i.parts[i.currentPart].start())}function lr(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function fr(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function hr(i,e,t){return e&&fr(i.prototype,e),i}var pr=function(){function i(e,t){lr(this,i),Object.defineProperty(this,"bpm",{get:function(){return this._bpm},set:function(u){this.musicalTimeMode||console.warn('Changing the BPM in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._bpm=u,this._update()}}),Object.defineProperty(this,"timeSignature",{get:function(){return this._timeSignature},set:function(u){this.musicalTimeMode||console.warn('Changing the timeSignature in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._timeSignature=u,this._update()}}),Object.defineProperty(this,"interval",{get:function(){return this._interval},set:function(u){this.musicalTimeMode=typeof u!="number",this._interval=u,this._update()}}),Object.defineProperty(this,"iterations",{get:function(){return this.clock.ticks}}),this.callback=e,this.musicalTimeMode=typeof this._interval!="number",this._interval=t||1,this._timeSignature=4,this._bpm=60,this.isPlaying=!1,this.maxIterations=1/0;var n=this;this.clock=new ke.a({callback:function(u){var m=u-a.audiocontext.currentTime;m>0&&n.iterations<=n.maxIterations&&n.callback(m)},frequency:this._calcFreq()})}return hr(i,[{key:"start",value:function(t){var n=t||0,s=a.audiocontext.currentTime;this.isPlaying||(this.clock.start(s+n),this.isPlaying=!0)}},{key:"stop",value:function(t){var n=t||0,s=a.audiocontext.currentTime;this.isPlaying&&(this.clock.stop(s+n),this.isPlaying=!1)}},{key:"pause",value:function(t){var n=t||0,s=a.audiocontext.currentTime;this.isPlaying&&(this.clock.pause(s+n),this.isPlaying=!1)}},{key:"syncedStart",value:function(t,n){var s=n||0,u=a.audiocontext.currentTime;if(!t.isPlaying)t.clock.start(u+s),t.isPlaying=!0,this.clock.start(u+s),this.isPlaying=!0;else if(t.isPlaying){var m=t.clock._nextTick-a.audiocontext.currentTime;this.clock.start(u+m),this.isPlaying=!0}}},{key:"_update",value:function(){this.clock.frequency.value=this._calcFreq()}},{key:"_calcFreq",value:function(){if(typeof this._interval=="number")return this.musicalTimeMode=!1,1/this._interval;if(typeof this._interval=="string")return this.musicalTimeMode=!0,this._bpm/60/this._convertNotation(this._interval)*(this._timeSignature/4)}},{key:"_convertNotation",value:function(t){var n=t.slice(-1);switch(t=Number(t.slice(0,-1)),n){case"m":return this._measure(t);case"n":return this._note(t);default:console.warn("Specified interval is not formatted correctly. See Tone.js timing reference for more info: https://github.com/Tonejs/Tone.js/wiki/Time")}}},{key:"_measure",value:function(t){return t*this._timeSignature}},{key:"_note",value:function(t){return this._timeSignature/t}}]),i}(),dr=pr;function Ct(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ct=function(t){return typeof t}:Ct=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ct(i)}function mr(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function yr(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function vr(i,e,t){return e&&yr(i.prototype,e),i}function _r(i,e){return e&&(Ct(e)==="object"||typeof e=="function")?e:gr(i)}function gr(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Rt(i,e,t){return typeof Reflect<"u"&&Reflect.get?Rt=Reflect.get:Rt=function(s,u,m){var v=br(s,u);if(v){var b=Object.getOwnPropertyDescriptor(v,u);return b.get?b.get.call(m):b.value}},Rt(i,e,t||i)}function br(i,e){for(;!Object.prototype.hasOwnProperty.call(i,e)&&(i=nt(i),i!==null););return i}function nt(i){return nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},nt(i)}function Tr(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&se(i,e)}function se(i,e){return se=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},se(i,e)}var wr=function(i){Tr(e,i);function e(){var t;return mr(this,e),t=_r(this,nt(e).call(this)),t.compressor=t.ac.createDynamicsCompressor(),t.input.connect(t.compressor),t.compressor.connect(t.wet),t}return vr(e,[{key:"process",value:function(n,s,u,m,v,b){n.connect(this.input),this.set(s,u,m,v,b)}},{key:"set",value:function(n,s,u,m,v){typeof n<"u"&&this.attack(n),typeof s<"u"&&this.knee(s),typeof u<"u"&&this.ratio(u),typeof m<"u"&&this.threshold(m),typeof v<"u"&&this.release(v)}},{key:"attack",value:function(n,s){var u=s||0;return typeof n=="number"?(this.compressor.attack.value=n,this.compressor.attack.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.attack.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof n<"u"&&n.connect(this.compressor.attack),this.compressor.attack.value}},{key:"knee",value:function(n,s){var u=s||0;return typeof n=="number"?(this.compressor.knee.value=n,this.compressor.knee.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.knee.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof n<"u"&&n.connect(this.compressor.knee),this.compressor.knee.value}},{key:"ratio",value:function(n,s){var u=s||0;return typeof n=="number"?(this.compressor.ratio.value=n,this.compressor.ratio.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.ratio.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof n<"u"&&n.connect(this.compressor.ratio),this.compressor.ratio.value}},{key:"threshold",value:function(n,s){var u=s||0;return typeof n=="number"?(this.compressor.threshold.value=n,this.compressor.threshold.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.threshold.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof n<"u"&&n.connect(this.compressor.threshold),this.compressor.threshold.value}},{key:"release",value:function(n,s){var u=s||0;return typeof n=="number"?(this.compressor.release.value=n,this.compressor.release.cancelScheduledValues(this.ac.currentTime+.01+u),this.compressor.release.linearRampToValueAtTime(n,this.ac.currentTime+.02+u)):typeof number<"u"&&n.connect(this.compressor.release),this.compressor.release.value}},{key:"reduction",value:function(){return this.compressor.reduction.value}},{key:"dispose",value:function(){Rt(nt(e.prototype),"dispose",this).call(this),this.compressor&&(this.compressor.disconnect(),delete this.compressor)}}]),e}(W),Sr=wr;function Ar(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Pr(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function xr(i,e,t){return e&&Pr(i.prototype,e),i}var kr=function(){function i(e,t,n,s){Ar(this,i),this.framesPerPeak=s||20,this.framesSinceLastPeak=0,this.decayRate=.95,this.threshold=n||.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=e||40,this.f2=t||2e4,this._onPeak=function(){}}return xr(i,[{key:"update",value:function(t){var n=this.energy=t.getEnergy(this.f1,this.f2)/255;n>this.cutoff&&n>this.threshold&&n-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=n*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=n,this.penergy=n}},{key:"onPeak",value:function(t,n){var s=this;s._onPeak=function(){t(s.energy,n)}}}]),i}(),Re=kr;function Or(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Er(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Cr(i,e,t){return e&&Er(i.prototype,e),i}var Nt=a.audiocontext,Rr=function(){function i(){Or(this,i),this.input=Nt.createGain(),this.output=Nt.createGain(),this._inputChannels=2,this._outputChannels=2;var e=I(1024);this._workletNode=new AudioWorkletNode(Nt,l.a.recorderProcessor,{outputChannelCount:[this._outputChannels],processorOptions:{numInputChannels:this._inputChannels,bufferSize:e}}),this._workletNode.port.onmessage=(function(t){if(t.data.name==="buffers"){var n=[new Float32Array(t.data.leftBuffer),new Float32Array(t.data.rightBuffer)];this._callback(n)}}).bind(this),this._callback=function(){},this._workletNode.connect(p5.soundOut._silentNode),this.setInput(),a.soundArray.push(this)}return Cr(i,[{key:"setInput",value:function(t){this.input.disconnect(),this.input=null,this.input=Nt.createGain(),this.input.connect(this._workletNode),this.input.connect(this.output),t?t.connect(this.input):p5.soundOut.output.connect(this.input)}},{key:"record",value:function(t,n,s){this._workletNode.port.postMessage({name:"start",duration:n}),t&&s?this._callback=function(u){t.setBuffer(u),s()}:t&&(this._callback=function(u){t.setBuffer(u)})}},{key:"stop",value:function(){this._workletNode.port.postMessage({name:"stop"})}},{key:"dispose",value:function(){var t=a.soundArray.indexOf(this);a.soundArray.splice(t,1),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._workletNode=null}}]),i}(),Nr=Rr;function Dt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Dt=function(t){return typeof t}:Dt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dt(i)}function Dr(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Fr(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Br(i,e,t){return e&&Fr(i.prototype,e),i}function Mr(i,e){return e&&(Dt(e)==="object"||typeof e=="function")?e:Ir(i)}function Ir(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Ft(i,e,t){return typeof Reflect<"u"&&Reflect.get?Ft=Reflect.get:Ft=function(s,u,m){var v=qr(s,u);if(v){var b=Object.getOwnPropertyDescriptor(v,u);return b.get?b.get.call(m):b.value}},Ft(i,e,t||i)}function qr(i,e){for(;!Object.prototype.hasOwnProperty.call(i,e)&&(i=it(i),i!==null););return i}function it(i){return it=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},it(i)}function Ur(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&ae(i,e)}function ae(i,e){return ae=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},ae(i,e)}function Ne(i){for(var e=typeof i=="number"?i:50,t=44100,n=new Float32Array(t),s=Math.PI/180,u=0,m;u<t;++u)m=u*2/t-1,n[u]=(3+e)*m*20*s/(Math.PI+e*Math.abs(m));return n}var Vr=function(i){Ur(e,i);function e(t,n){var s;if(Dr(this,e),s=Mr(this,it(e).call(this)),typeof t>"u"&&(t=.25),typeof t!="number")throw new Error("amount must be a number");if(typeof n>"u"&&(n="2x"),typeof n!="string")throw new Error("oversample must be a String");var u=p5.prototype.map(t,0,1,0,2e3);return s.waveShaperNode=s.ac.createWaveShaper(),s.amount=u,s.waveShaperNode.curve=Ne(u),s.waveShaperNode.oversample=n,s.input.connect(s.waveShaperNode),s.waveShaperNode.connect(s.wet),s}return Br(e,[{key:"process",value:function(n,s,u){n.connect(this.input),this.set(s,u)}},{key:"set",value:function(n,s){if(n){var u=p5.prototype.map(n,0,1,0,2e3);this.amount=u,this.waveShaperNode.curve=Ne(u)}s&&(this.waveShaperNode.oversample=s)}},{key:"getAmount",value:function(){return this.amount}},{key:"getOversample",value:function(){return this.waveShaperNode.oversample}},{key:"dispose",value:function(){Ft(it(e.prototype),"dispose",this).call(this),this.waveShaperNode&&(this.waveShaperNode.disconnect(),this.waveShaperNode=null)}}]),e}(W),Lr=Vr;function jr(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Wr(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Gr(i,e,t){return e&&Wr(i.prototype,e),i}var Yr=function(){function i(){jr(this,i),this.ac=a.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.output),a.soundArray.push(this)}return Gr(i,[{key:"setInput",value:function(t){t.connect(this.input)}},{key:"connect",value:function(t){var n=t||p5.soundOut.input;this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"amp",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=a.audiocontext.currentTime,m=this.output.gain.value;this.output.gain.cancelScheduledValues(u),this.output.gain.linearRampToValueAtTime(m,u+s),this.output.gain.linearRampToValueAtTime(t,u+s+n)}},{key:"dispose",value:function(){var t=a.soundArray.indexOf(this);a.soundArray.splice(t,1),this.output&&(this.output.disconnect(),delete this.output),this.input&&(this.input.disconnect(),delete this.input)}}]),i}(),zr=Yr;function Kr(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Zr(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Xr(i,e,t){return e&&Zr(i.prototype,e),i}var Qr=function(){function i(){Kr(this,i),this.ac=a.audiocontext,this.output=this.ac.createGain(),this.connect(),a.soundArray.push(this)}return Xr(i,[{key:"play",value:function(t,n,s,u){}},{key:"triggerAttack",value:function(t,n,s){}},{key:"triggerRelease",value:function(t){}},{key:"amp",value:function(t,n){}},{key:"connect",value:function(t){var n=t||a.input;this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.output.disconnect()}},{key:"dispose",value:function(){this.output&&(this.output.disconnect(),delete this.output)}}]),i}(),De=Qr;function Bt(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Bt=function(t){return typeof t}:Bt=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bt(i)}function Hr(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function $r(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function Jr(i,e,t){return e&&$r(i.prototype,e),i}function to(i,e){return e&&(Bt(e)==="object"||typeof e=="function")?e:ue(i)}function ue(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Mt(i,e,t){return typeof Reflect<"u"&&Reflect.get?Mt=Reflect.get:Mt=function(s,u,m){var v=eo(s,u);if(v){var b=Object.getOwnPropertyDescriptor(v,u);return b.get?b.get.call(m):b.value}},Mt(i,e,t||i)}function eo(i,e){for(;!Object.prototype.hasOwnProperty.call(i,e)&&(i=rt(i),i!==null););return i}function rt(i){return rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},rt(i)}function no(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),e&&ce(i,e)}function ce(i,e){return ce=Object.setPrototypeOf||function(n,s){return n.__proto__=s,n},ce(i,e)}var io=.15,ro=function(i){no(e,i);function e(){var t;return Hr(this,e),t=to(this,rt(e).call(this)),t.oscillator=new ht,t.env=new On,t.env.setRange(1,0),t.env.setExp(!0),t.setADSR(.02,.25,.05,.35),t.oscillator.disconnect(),t.oscillator.connect(t.output),t.env.disconnect(),t.env.setInput(t.output.gain),t.oscillator.output.gain.value=1,t.oscillator.start(),t.connect(),a.soundArray.push(ue(t)),Object.defineProperties(ue(t),{attack:{get:function(){return this.env.aTime},set:function(s){this.env.setADSR(s,this.env.dTime,this.env.sPercent,this.env.rTime)}},decay:{get:function(){return this.env.dTime},set:function(s){this.env.setADSR(this.env.aTime,s,this.env.sPercent,this.env.rTime)}},sustain:{get:function(){return this.env.sPercent},set:function(s){this.env.setADSR(this.env.aTime,this.env.dTime,s,this.env.rTime)}},release:{get:function(){return this.env.rTime},set:function(s){this.env.setADSR(this.env.aTime,this.env.dTime,this.env.sPercent,s)}}}),t}return Jr(e,[{key:"play",value:function(n,s,u,m){this.triggerAttack(n,s,~~u),this.triggerRelease(~~u+(m||io))}},{key:"triggerAttack",value:function(n,s){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,m=k(n),v=s||.1;this.oscillator.freq(m,0,u),this.env.ramp(this.output.gain,u,v)}},{key:"triggerRelease",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.env.ramp(this.output.gain,n,0)}},{key:"setADSR",value:function(n,s,u,m){this.env.setADSR(n,s,u,m)}},{key:"amp",value:function(n,s){var u=s||0;return typeof n<"u"&&this.oscillator.amp(n,u),this.oscillator.amp().value}},{key:"connect",value:function(n){var s=n||a.input;this.output.connect(s.input?s.input:s)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"dispose",value:function(){Mt(rt(e.prototype),"dispose",this).call(this),this.env&&this.env.dispose(),this.oscillator&&this.oscillator.dispose()}}]),e}(De),oo=ro;function so(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function ao(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function uo(i,e,t){return e&&ao(i.prototype,e),i}var co=function(){function i(e,t,n,s){so(this,i),this.isDetected=!1,this.freqLow=e,this.freqHigh=t,this.treshold=n,this.energy=0,this.penergy=0,this.sensitivity=500,this.callback=s}return uo(i,[{key:"update",value:function(t,n){if(this.energy=t.getEnergy(this.freqLow,this.freqHigh)/255,this.isDetected===!1&&this.energy-this.penergy>this.treshold){this.isDetected=!0,this.callback?this.callback(this.energy):n&&n(this.energy);var s=this;setTimeout(function(){s.isDetected=!1},this.sensitivity)}this.penergy=this.energy}}]),i}(),lo=co;function fo(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function ho(i,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function po(i,e,t){return e&&ho(i.prototype,e),i}var mo=function(){function i(e,t){fo(this,i),this.audiovoices=[],this.notes={},this._newest=0,this._oldest=0,this.maxVoices=t||8,this.AudioVoice=e===void 0?p5.MonoSynth:e,this._voicesInUse=new Yt.a(0),this.output=a.audiocontext.createGain(),this.connect(),this._allocateVoices(),a.soundArray.push(this)}return po(i,[{key:"_allocateVoices",value:function(){for(var t=0;t<this.maxVoices;t++)this.audiovoices.push(new this.AudioVoice),this.audiovoices[t].disconnect(),this.audiovoices[t].connect(this.output)}},{key:"play",value:function(t,n,s){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;this.noteAttack(t,n,s),this.noteRelease(t,s+u)}},{key:"noteADSR",value:function(t,n,s,u,m){var v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,b=a.audiocontext.currentTime,P=b+v;this.audiovoices[this.notes[t].getValueAtTime(P)].setADSR(n,s,u,m)}},{key:"setADSR",value:function(t,n,s,u){this.audiovoices.forEach(function(m){m.setADSR(t,n,s,u)})}},{key:"noteAttack",value:function(t,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=a.audiocontext.currentTime+s,m=k(t),v=n||.1,b;this.notes[m]&&this.notes[m].getValueAtTime(u)!==null&&this.noteRelease(m,0),this._voicesInUse.getValueAtTime(u)<this.maxVoices?b=Math.max(~~this._voicesInUse.getValueAtTime(u),0):(b=this._oldest,oldestNote=w(this.audiovoices[this._oldest].oscillator.freq().value),this.noteRelease(oldestNote),this._oldest=(this._oldest+1)%(this.maxVoices-1)),this.notes[m]=new Yt.a,this.notes[m].setValueAtTime(b,u);var P=this._voicesInUse._searchBefore(u)===null?0:this._voicesInUse._searchBefore(u).value;if(this._voicesInUse.setValueAtTime(P+1,u),this._updateAfter(u,1),this._newest=b,typeof v=="number"){var x=1/this._voicesInUse.getValueAtTime(u)*2;v=v>x?x:v}this.audiovoices[b].triggerAttack(m,v,s)}},{key:"_updateAfter",value:function(t,n){if(this._voicesInUse._searchAfter(t)!==null){this._voicesInUse._searchAfter(t).value+=n;var s=this._voicesInUse._searchAfter(t).time;this._updateAfter(s,n)}}},{key:"noteRelease",value:function(t,n){var s=a.audiocontext.currentTime,u=n||0,m=s+u;if(!t){this.audiovoices.forEach(function(x){x.triggerRelease(u)}),this._voicesInUse.setValueAtTime(0,m);for(var v in this.notes)this.notes[v].dispose(),delete this.notes[v];return}var b=k(t);if(!this.notes[b]||this.notes[b].getValueAtTime(m)===null)console.warn("Cannot release a note that is not already playing");else{var P=Math.max(~~this._voicesInUse.getValueAtTime(m).value,1);this._voicesInUse.setValueAtTime(P-1,m),P>0&&this._updateAfter(m,-1),this.audiovoices[this.notes[b].getValueAtTime(m)].triggerRelease(u),this.notes[b].dispose(),delete this.notes[b],this._newest=this._newest===0?0:(this._newest-1)%(this.maxVoices-1)}}},{key:"connect",value:function(t){var n=t||a.input;this.output.connect(n.input?n.input:n)}},{key:"disconnect",value:function(){this.output&&this.output.disconnect()}},{key:"dispose",value:function(){this.audiovoices.forEach(function(t){t.dispose()}),this.output&&(this.output.disconnect(),delete this.output)}}]),i}(),yo=mo;function vo(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var _o=function i(){vo(this,i),console.warn("p5.Signal is deprecated , Use Tone.js Signal instead ")},go=_o;p5.prototype.getAudioContext=g.b,p5.prototype.userStartAudio=g.c,p5.prototype.sampleRate=_,p5.prototype.freqToMidi=w,p5.prototype.midiToFreq=S,p5.prototype.noteToFreq=k,p5.prototype.soundFormats=A,p5.prototype.disposeSound=R,p5.prototype._checkFileFormats=O,p5.prototype._mathChain=N,p5.prototype.convertToWav=E,p5.prototype.interleave=M,p5.prototype.writeUTFBytes=D,p5.prototype.safeBufferSize=I,p5.prototype.saveSound=je,p5.prototype.registerMethod("remove",p5.prototype.disposeSound),p5.Panner=jt,p5.SoundFile=nn,p5.prototype.loadSound=en,p5.prototype.registerPreloadMethod("loadSound",p5.prototype),p5.Amplitude=ye,p5.FFT=yn,p5.Oscillator=ht,p5.SinOsc=Sn,p5.TriOsc=An,p5.SawOsc=ve,p5.SqrOsc=Pn,p5.Noise=Mn,p5.Pulse=zn,p5.AudioIn=Hn,p5.Effect=W,p5.Filter=Tt,p5.LowPass=ui,p5.HighPass=ci,p5.BandPass=li,p5.EQ=ki,p5.listener3D=Ni,p5.Panner3D=Li,p5.Delay=Qi,p5.Reverb=Pe,p5.Convolver=xe,p5.prototype.createConvolver=tr,p5.prototype.registerPreloadMethod("createConvolver",p5.prototype),p5.Metro=Oe,p5.Phrase=oe,p5.Part=ar,p5.Score=ur,p5.SoundLoop=dr,p5.Compressor=Sr,p5.peakDetect=Re,p5.SoundRecorder=Nr,p5.Distortion=Lr,p5.Gain=zr,p5.AudioVoice=De,p5.MonoSynth=oo,p5.OnsetDetect=lo,p5.PolySynth=yo,p5.PeakDetect=Re,p5.Signal=go}])})();let ot;const Po=()=>{ot=p.loadSound("ihanaifull.wav")},xo=()=>{ot.isPlaying()?ot.pause():ot.play(0,1,1,0)},ko=()=>{document.querySelector("canvas").addEventListener("click",()=>{xo()})},Ut=()=>ot.currentTime();class Oo{constructor(T,h,g,f,o,r){z(this,"lyric");z(this,"furigana");z(this,"index");z(this,"length");z(this,"start");z(this,"end");this.lyric=T,this.furigana=h,this.index=g,this.length=f,this.start=o,this.end=r}get pattern(){return[["あ","か","が","さ","ざ","た","だ","な","は","ば","ぱ","ま","や","ら","わ"],["い","き","ぎ","し","じ","ち","ぢ","に","ひ","び","ぴ","み","り"],["う","く","ぐ","す","ず","つ","づ","ぬ","ふ","ぶ","ぷ","む","ゆ","る"],["え","け","げ","せ","ぜ","て","で","ね","へ","べ","ぺ","め","れ"],["お","こ","ご","そ","ぞ","と","ど","の","ほ","ぼ","ぽ","も","よ","ろ","を"],["ん","っ"],["ー"]].findIndex(h=>h.includes(this.furigana))}}let Ue,Ve;const Eo=()=>{Ue=p.loadJSON("data.json")},Co=()=>{Ve=Ue.notes.map(y=>new Oo(y.lyric,y.furigana,y.index,y.length,y.start,y.end))},It={linear:y=>y,easeInQuad:y=>y*y,easeOutQuad:y=>y*(2-y),easeInOutQuad:y=>y<.5?2*y*y:-1+(4-2*y)*y,easeInCubic:y=>y*y*y,easeOutCubic:y=>--y*y*y+1,easeInOutCubic:y=>y<.5?4*y*y*y:(y-1)*(2*y-2)*(2*y-2)+1,easeInQuart:y=>y*y*y*y,easeOutQuart:y=>1- --y*y*y*y,easeInOutQuart:y=>y<.5?8*y*y*y*y:1-8*--y*y*y*y,easeInQuint:y=>y*y*y*y*y,easeOutQuint:y=>1+--y*y*y*y*y,easeInOutQuint:y=>y<.5?16*y*y*y*y*y:1+16*--y*y*y*y*y},Be=(y,T,h,g)=>{const f=Ut()*(qt/60)-h[h.length-1].start,o=Ut()*(qt/60)-y.start;if(!(h.length-T>40)){p.push();{p.translate(0,-p.lerp(h.length-(T+1),h.length-T,It.easeInOutQuad(p.min(f*(1/p.min(h[h.length-1].end,1/3)),1)))*(F/12/4)),o*6<1&&p.translate(0,-p.lerp(h.length-(T+3),h.length-(T+1),It.easeOutCubic(p.min(o*6,1)))*(F/12/4)),p.translate(-(F/2)+y.start%4*(F/4),le/3),p.translate(-(F*g),0),p.translate(0,p.sin((Ut()*(qt/60)+T)*(p.PI/2))*(F/12/8)),p.push(),p.rectMode(p.CORNERS),p.push(),p.pop(),p.pop(),p.push();{if(y.pattern===6&&T!==0){p.translate(-(F/4*(1/3)),0);const r=y.end+1/3;p.translate(F/4*It.easeOutCubic(p.norm(p.min(o,r),0,r))*(r-1/3),0)}else y.end>1/3&&p.translate(F/4*It.easeOutCubic(p.norm(p.min(o,y.end),0,y.end))*(y.end-1/3),0);p.textAlign(p.LEFT,p.CENTER),y.pattern===6&&T!==0?p.fill(Fe[h[T-1].pattern]):p.fill(Fe[y.pattern]),p.push(),qe(),p.textSize(F/12),p.beginClip(),p.rectMode(p.CORNERS),p.rect(0,-(F/12),p.min(F/12,F/4*y.end),F/12),p.endClip(),p.scale(p.min(1,y.end/(1/3)),1),p.translate(-(y.index*(F/12)),0),p.scale(1/y.lyric.length,1),p.scale(y.length,1),p.text(y.lyric,0,0),p.pop(),p.push(),Ao(),p.textSize(F/12),p.translate(0,-(F/12/2)-20),p.scale(p.min(1,y.end/(1/3)),1/3),!/[\u3040-\u309F\u30A1-\u30F4\u30FC]/.test(y.lyric)&&p.text(y.furigana,0,0),p.pop()}p.pop()}p.pop()}},Ro=(y,T,h)=>{h.length-T===1&&y.pattern===1&&p.filter(p.INVERT)},No=()=>{So(),Po(),Eo()},Le=()=>{const y=document.querySelector("canvas");y.style.position="absolute",y.style.top="50%",y.style.left="50%";const T=Math.min(window.innerWidth/F,window.innerHeight/le);y.style.transform=`translate(-50%, -50%) scale(${T})`},Do=()=>{p.createCanvas(F,le,p.WEBGL),p.pixelDensity(1),p.noSmooth(),p.frameRate(wo),Co(),ko(),qe(),Le()},Fo=()=>{p.background(255),Ve.filter(y=>{const T=60/qt;return Ut()>=y.start*T}).forEach((y,T,h)=>{Be(y,T,h,0),y.start%4+y.end>4.00001&&Be(y,T,h,p.floor(y.start%4+y.end)/4),Ro(y,T,h)})};window.onload=()=>{new p5(y=>{window.p=y,y.preload=No,y.setup=Do,y.draw=Fo,y.windowResized=Le})};
